Õ
HC:\Users\Kamile\source\repos\BeautySalon\Repository\ArticleRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
ArticleRepository "
:" #
RepositoryBase$ 2
<2 3
Article3 :
>: ;
,; <
IArticleRepository= O
{ 
public 
ArticleRepository  
(  !
RepositoryContext! 2
repositoryContext3 D
)D E
:F G
baseG K
(K L
repositoryContextL ]
)] ^
{ 	
} 	
public 
IEnumerable 
< 
Article "
>" #
GetAllArticles$ 2
(2 3
)3 4
{ 	
return 
FindAll 
( 
) 
. 
OrderBy $
($ %
x% &
=>' )
x* +
.+ ,
Id, .
). /
./ 0
ToList0 6
(6 7
)7 8
;8 9
} 	
public 
IEnumerable 
< 
Article "
>" #
GetArticlesByMaster$ 7
(7 8
int8 ;
masterId< D
)D E
{ 	
return 
FindByCondition "
(" #
article# *
=>+ -
article. 5
.5 6
UserId6 <
.< =
Equals= C
(C D
masterIdD L
)L M
)M N
.N O
ToListO U
(U V
)V W
;W X
} 	
[ 	
HttpGet	 
( 
$str 
, 
Name 
= 
nameof  &
(& '
GetArticleById' 5
)5 6
)6 7
]7 8
public   
Article   
GetArticleById   %
(  % &
int  & )
	articleId  * 3
)  3 4
{!! 	
return"" 
FindByCondition"" "
(""" #
article""# *
=>""+ -
article"". 5
.""5 6
Id""6 8
.""8 9
Equals""9 ?
(""? @
	articleId""@ I
)""I J
)""J K
.""K L
DefaultIfEmpty""L Z
(""Z [
new""[ ^
Article""_ f
(""f g
)""g h
)""h i
.""i j
FirstOrDefault""j x
(""x y
)""y z
;""z {
}## 	
public%% 
void%% 
CreateArticle%% !
(%%! "
Article%%" )
article%%* 1
)%%1 2
{&& 	
article'' 
.'' 
PublishingTime'' "
=''# $
DateTime''% -
.''- .
UtcNow''. 4
;''4 5
Create(( 
((( 
article(( 
)(( 
;(( 
})) 	
public++ 
void++ 
UpdateArticle++ !
(++! "
Article++" )
	dbArticle++* 3
,++3 4
Article++5 <
article++= D
)++D E
{,, 	
	dbArticle-- 
.-- 
Map-- 
(-- 
article-- !
)--! "
;--" #
Update.. 
(.. 
	dbArticle.. 
).. 
;.. 
}// 	
public11 
void11 
DeleteArticle11 !
(11! "
Article11" )
article11* 1
)111 2
{22 	
Delete33 
(33 
article33 
)33 
;33 
}44 	
}55 
}66 «;
BC:\Users\Kamile\source\repos\BeautySalon\Repository\AuthService.cs
	namespace 	

Repository
 
{ 
public 

class 
AuthService 
: 
IAuthService +
{ 
private 
readonly 
IUserRepository (
_userRep) 1
;1 2
private 
readonly 
AppSettings $
_appSettings% 1
;1 2
public 
AuthService 
( 
IUserRepository *
service+ 2
,2 3
IOptions4 <
<< =
AppSettings= H
>H I
tokenManagementJ Y
)Y Z
{ 	
_userRep 
= 
service 
; 
_appSettings 
= 
tokenManagement *
.* +
Value+ 0
;0 1
} 	
public 
bool 
IsAuthenticated #
(# $
AuthData$ ,
request- 4
,4 5
out6 9
string: @
tokenA F
)F G
{ 	
token 
= 
string 
. 
Empty  
;  !
if 
( 
! 
_userRep 
. 
IsValidUser %
(% &
request& -
.- .
Email. 3
,3 4
request5 <
.< =
Password= E
)E F
)F G
returnH N
falseO T
;T U
User 
user 
= 
_userRep  
.  !
GetUserByEmail! /
(/ 0
request0 7
.7 8
Email8 =
)= >
;> ?
var 
claim 
= 
new 
[ 
] 
{   
new!! 
Claim!! 
(!! 

ClaimTypes!! $
.!!$ %
Email!!% *
,!!* +
request!!, 3
.!!3 4
Email!!4 9
)!!9 :
,!!: ;
new"" 
Claim"" 
("" 

ClaimTypes"" $
.""$ %
Role""% )
,"") *
user""+ /
.""/ 0
UserType""0 8
)""8 9
}## 
;## 
var$$ 
key$$ 
=$$ 
new$$  
SymmetricSecurityKey$$ .
($$. /
Encoding$$/ 7
.$$7 8
UTF8$$8 <
.$$< =
GetBytes$$= E
($$E F
_appSettings$$F R
.$$R S
Secret$$S Y
)$$Y Z
)$$Z [
;$$[ \
var%% 
credentials%% 
=%% 
new%% !
SigningCredentials%%" 4
(%%4 5
key%%5 8
,%%8 9
SecurityAlgorithms%%: L
.%%L M

HmacSha256%%M W
)%%W X
;%%X Y
var'' 
jwtToken'' 
='' 
new'' 
JwtSecurityToken'' /
(''/ 0
_appSettings(( 
.(( 
Issuer(( #
,((# $
_appSettings)) 
.)) 
Audience)) %
,))% &
claim** 
,** 
expires++ 
:++ 
DateTime++ !
.++! "
Now++" %
.++% &

AddMinutes++& 0
(++0 1
_appSettings++1 =
.++= >
AccessExpiration++> N
)++N O
,++O P
signingCredentials,, "
:,," #
credentials,,$ /
)-- 
;-- 
token.. 
=.. 
new.. #
JwtSecurityTokenHandler.. /
(../ 0
)..0 1
...1 2

WriteToken..2 <
(..< =
jwtToken..= E
)..E F
;..F G
return// 
true// 
;// 
}00 	
public33 
JwtSecurityToken33 
	ReadToken33  )
(33) *
string33* 0
header331 7
)337 8
{44 	
var55 
actualToken55 
=55 
(55 
header55 %
.55% &
Split55& +
(55+ ,
$char55, /
)55/ 0
)550 1
[551 2
$num552 3
]553 4
;554 5
var66 
handler66 
=66 
new66 #
JwtSecurityTokenHandler66 5
(665 6
)666 7
;667 8
var77 
token77 
=77 
handler77 
.77  
ReadJwtToken77  ,
(77, -
actualToken77- 8
)778 9
;779 :
return88 
token88 
;88 
}99 	
public;; 
bool;; 
IsAdmin;; 
(;; 
string;; "
header;;# )
);;) *
{<< 	
var== 
token== 
=== 
	ReadToken== !
(==! "
header==" (
)==( )
;==) *
if>> 
(>> 
token>> 
.>> 
Payload>> 
[>> 

ClaimTypes>> '
.>>' (
Role>>( ,
]>>, -
.>>- .
Equals>>. 4
(>>4 5
$str>>5 <
)>>< =
)>>= >
{?? 
return@@ 
true@@ 
;@@ 
}AA 
returnBB 
falseBB 
;BB 
}CC 	
publicEE 
boolEE 
IsMasterEE 
(EE 
stringEE #
headerEE$ *
)EE* +
{FF 	
varGG 
tokenGG 
=GG 
	ReadTokenGG !
(GG! "
headerGG" (
)GG( )
;GG) *
ifHH 
(HH 
tokenHH 
.HH 
PayloadHH 
[HH 

ClaimTypesHH (
.HH( )
RoleHH) -
]HH- .
.HH. /
EqualsHH/ 5
(HH5 6
$strHH6 >
)HH> ?
)HH? @
{II 
returnJJ 
trueJJ 
;JJ 
}KK 
returnLL 
falseLL 
;LL 
}MM 	
publicOO 
boolOO 
IsClientOO 
(OO 
stringOO #
headerOO$ *
)OO* +
{PP 	
varQQ 
tokenQQ 
=QQ 
	ReadTokenQQ !
(QQ! "
headerQQ" (
)QQ( )
;QQ) *
ifRR 
(RR 
tokenRR 
.RR 
PayloadRR 
[RR 

ClaimTypesRR (
.RR( )
RoleRR) -
]RR- .
.RR. /
EqualsRR/ 5
(RR5 6
$strRR6 >
)RR> ?
)RR? @
{SS 
returnTT 
trueTT 
;TT 
}UU 
returnVV 
falseVV 
;VV 
}WW 	
publicYY 
intYY 
GetIdYY 
(YY 
stringYY 
headerYY  &
)YY& '
{ZZ 	
var[[ 
token[[ 
=[[ 
	ReadToken[[ !
([[! "
header[[" (
)[[( )
;[[) *
User\\ 
user\\ 
=\\ 
_userRep\\  
.\\  !
GetUserByEmail\\! /
(\\/ 0
token\\0 5
.\\5 6
Payload\\6 =
[\\= >

ClaimTypes\\> H
.\\H I
Email\\I N
]\\N O
.\\O P
ToString\\P X
(\\X Y
)\\Y Z
)\\Z [
;\\[ \
return]] 
user]] 
.]] 
Id]] 
;]] 
}^^ 	
}`` 
}aa ª
EC:\Users\Kamile\source\repos\BeautySalon\Repository\RepositoryBase.cs
	namespace		 	

Repository		
 
{

 
public 

abstract 
class 
RepositoryBase (
<( )
T) *
>* +
:, -
IRepositoryBase. =
<= >
T> ?
>? @
whereA F
TG H
:I J
classK P
{ 
	protected 
RepositoryContext #
RepositoryContext$ 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
RepositoryBase 
( 
RepositoryContext /
repositoryContext0 A
)A B
{ 	
this 
. 
RepositoryContext "
=# $
repositoryContext% 6
;6 7
} 	
public 

IQueryable 
< 
T 
> 
FindAll $
($ %
)% &
{ 	
return 
this 
. 
RepositoryContext )
.) *
Set* -
<- .
T. /
>/ 0
(0 1
)1 2
.2 3
AsNoTracking3 ?
(? @
)@ A
;A B
} 	
public 

IQueryable 
< 
T 
> 
FindByCondition ,
(, -

Expression- 7
<7 8
Func8 <
<< =
T= >
,> ?
bool@ D
>D E
>E F

expressionG Q
)Q R
{ 	
return 
this 
. 
RepositoryContext )
.) *
Set* -
<- .
T. /
>/ 0
(0 1
)1 2
.2 3
Where3 8
(8 9

expression9 C
)C D
.D E
AsNoTrackingE Q
(Q R
)R S
;S T
} 	
public 
void 
Create 
( 
T 
entity #
)# $
{ 	
this   
.   
RepositoryContext   "
.  " #
Set  # &
<  & '
T  ' (
>  ( )
(  ) *
)  * +
.  + ,
Add  , /
(  / 0
entity  0 6
)  6 7
;  7 8
}!! 	
public## 
void## 
Update## 
(## 
T## 
entity## #
)### $
{$$ 	
this%% 
.%% 
RepositoryContext%% "
.%%" #
Set%%# &
<%%& '
T%%' (
>%%( )
(%%) *
)%%* +
.%%+ ,
Update%%, 2
(%%2 3
entity%%3 9
)%%9 :
;%%: ;
}&& 	
public(( 
void(( 
Delete(( 
((( 
T(( 
entity(( #
)((# $
{)) 	
this** 
.** 
RepositoryContext** "
.**" #
Set**# &
<**& '
T**' (
>**( )
(**) *
)*** +
.**+ ,
Remove**, 2
(**2 3
entity**3 9
)**9 :
;**: ;
}++ 	
},, 
}-- í
HC:\Users\Kamile\source\repos\BeautySalon\Repository\RepositoryWrapper.cs
	namespace

 	

Repository


 
{ 
public 

class 
RepositoryWrapper "
:" #
IRepositoryWrapper$ 6
{ 
private 
RepositoryContext !
_repoContext" .
;. /
private 
IUserRepository 
_user  %
;% &
private  
ITimetableRepository $

_timetable% /
;/ 0
private 
IArticleRepository "
_article# +
;+ ,
private 
IServiceRepository "
_service# +
;+ ,
private "
IReservationRepository &
_reservation' 3
;3 4
public 
IUserRepository 
User #
{ 	
get 
{ 
if 
( 
_user 
== 
null !
)! "
{ 
_user 
= 
new 
UserRepository  .
(. /
_repoContext/ ;
); <
;< =
} 
return 
_user 
; 
} 
}   	
public""  
ITimetableRepository"" #
	Timetable""$ -
{## 	
get$$ 
{%% 
if&& 
(&& 

_timetable&& 
==&& !
null&&" &
)&&& '
{'' 

_timetable(( 
=((  
new((! $
TimetableRepository((% 8
(((8 9
_repoContext((9 E
)((E F
;((F G
})) 
return++ 

_timetable++ !
;++! "
},, 
}-- 	
public// 
IArticleRepository// !
Article//" )
{00 	
get11 
{22 
if33 
(33 
_article33 
==33 
null33  $
)33$ %
{44 
_article55 
=55 
new55 "
ArticleRepository55# 4
(554 5
_repoContext555 A
)55A B
;55B C
}66 
return88 
_article88 
;88  
}99 
}:: 	
public== 
IServiceRepository== !
Service==" )
{>> 	
get?? 
{@@ 
ifAA 
(AA 
_serviceAA 
==AA 
nullAA  $
)AA$ %
{BB 
_serviceCC 
=CC 
newCC "
ServiceRepositoryCC# 4
(CC4 5
_repoContextCC5 A
)CCA B
;CCB C
}DD 
returnFF 
_serviceFF 
;FF  
}GG 
}HH 	
publicJJ "
IReservationRepositoryJJ %
ReservationJJ& 1
{KK 	
getLL 
{MM 
ifNN 
(NN 
_reservationNN  
==NN! #
nullNN$ (
)NN( )
{OO 
_reservationPP  
=PP! "
newPP# &!
ReservationRepositoryPP' <
(PP< =
_repoContextPP= I
)PPI J
;PPJ K
}QQ 
returnSS 
_reservationSS #
;SS# $
}TT 
}UU 	
publicWW 
RepositoryWrapperWW  
(WW  !
RepositoryContextWW! 2
repositoryContextWW3 D
)WWD E
{XX 	
_repoContextYY 
=YY 
repositoryContextYY ,
;YY, -
}ZZ 	
public\\ 
void\\ 
Save\\ 
(\\ 
)\\ 
{]] 	
_repoContext^^ 
.^^ 
SaveChanges^^ $
(^^$ %
)^^% &
;^^& '
}__ 	
}`` 
}aa ðA
LC:\Users\Kamile\source\repos\BeautySalon\Repository\ReservationRepository.cs
	namespace 	

Repository
 
{ 
public 

class !
ReservationRepository &
:& '
RepositoryBase( 6
<6 7
Reservation7 B
>B C
,C D"
IReservationRepositoryE [
{ 
public !
ReservationRepository $
($ %
RepositoryContext% 6
repositoryContext7 H
)H I
:J K
baseK O
(O P
repositoryContextP a
)a b
{ 	
} 	
public 
IEnumerable 
< 
Reservation &
>& '
GetAllReservations( :
(: ;
); <
{ 	
return 
FindAll 
( 
) 
. 
OrderBy $
($ %
x% &
=>' )
x* +
.+ ,
Id, .
). /
./ 0
ToList0 6
(6 7
)7 8
;8 9
} 	
public 
IEnumerable 
< 
Reservation &
>& '!
GetReservationsByUser( =
(= >
int> A
userIdB H
)H I
{ 	
return 
FindByCondition "
(" #
a# $
=>% '
a( )
.) *
UserId* 0
.0 1
Equals1 7
(7 8
userId8 >
)> ?
)? @
.@ A
ToListA G
(G H
)H I
;I J
} 	
public 
IEnumerable 
< 
Reservation &
>& '#
ReservationsByTimetable( ?
(? @
DateTime@ H
dateI M
,M N
TimeSpanO W
startX ]
,] ^
TimeSpan_ g
endh k
)k l
{   	
return!! 
FindByCondition!! "
(!!" #
a!!# $
=>!!% '
a!!( )
.!!) *
	TimeStart!!* 3
.!!3 4
Date!!4 8
.!!8 9
Equals!!9 ?
(!!? @
date!!@ D
)!!D E
&&!!F H
a!!I J
.!!J K
	TimeStart!!K T
.!!T U
	TimeOfDay!!U ^
>=!!_ a
start!!b g
&&!!h j
a!!k l
.!!l m
TimeEnd!!m t
.!!t u
	TimeOfDay!!u ~
<=	!! 
end
!! 
&&
!! 
a
!! 
.
!! 
Status
!! 
!=
!! 
$str
!! 
)
!!  
.
!!  ¡
ToList
!!¡ §
(
!!§ ¨
)
!!¨ ©
;
!!© ª
}"" 	
public$$ 
IEnumerable$$ 
<$$ 
Reservation$$ &
>$$& '#
GetReservationsByMaster$$( ?
($$? @
int$$@ C
masterId$$D L
)$$L M
{%% 	
return&& 
FindByCondition&& "
(&&" #
a&&# $
=>&&% '
a&&( )
.&&) *
MasterId&&* 2
.&&2 3
Equals&&3 9
(&&9 :
masterId&&: B
)&&B C
)&&C D
.&&D E
ToList&&E K
(&&K L
)&&L M
;&&M N
}'' 	
public)) 
IEnumerable)) 
<)) 
Reservation)) &
>))& '*
GetReservationsByMasterAndDate))( F
())F G
int))G J
masterId))K S
,))S T
DateTime))U ]
date))^ b
)))b c
{** 	
return++ 
FindByCondition++ "
(++" #
a++# $
=>++% '
a++( )
.++) *
MasterId++* 2
.++2 3
Equals++3 9
(++9 :
masterId++: B
)++B C
&&++D F
a++G H
.++H I
	TimeStart++I R
.++R S
Date++S W
==++X Z
date++[ _
)++_ `
.++` a
ToList++a g
(++g h
)++h i
;++i j
},, 	
[.. 	
HttpGet..	 
(.. 
$str.. 
,.. 
Name.. 
=.. 
nameof..  &
(..& '
GetReservationById..' 9
)..9 :
)..: ;
]..; <
public// 
Reservation// 
GetReservationById// -
(//- .
int//. 1
reservationId//2 ?
)//? @
{00 	
return11 
FindByCondition11 "
(11" #
reservation11# .
=>11/ 1
reservation112 =
.11= >
Id11> @
.11@ A
Equals11A G
(11G H
reservationId11H U
)11U V
)11V W
.11W X
DefaultIfEmpty11X f
(11f g
new11g j
Reservation11k v
(11v w
)11w x
)11x y
.11y z
FirstOrDefault	11z 
(
11 
)
11 
;
11 
}22 	
public44 
bool44 
IsValid44 
(44 
int44 
masterId44  (
,44( )
DateTime44* 2
date443 7
,447 8
TimeSpan449 A
start44B G
,44G H
TimeSpan44I Q
end44R U
)44U V
{55 	
if66 
(66 
start66 
>66 
end66 
)66 
return66 #
false66$ )
;66) *
var77 
reservations77 
=77 *
GetReservationsByMasterAndDate77 =
(77= >
masterId77> F
,77F G
date77H L
)77L M
;77M N
foreach88 
(88 
Reservation88  
r88! "
in88# %
reservations88& 2
)882 3
{99 
if:: 
(:: 
(:: 
start:: 
>:: 
r:: 
.:: 
	TimeStart:: (
.::( )
	TimeOfDay::) 2
&&::3 5
start::6 ;
<::< =
r::> ?
.::? @
TimeEnd::@ G
.::G H
	TimeOfDay::H Q
)::Q R
||::S U
(;; 
end;; 
>;; 
r;; 
.;; 
	TimeStart;; &
.;;& '
	TimeOfDay;;' 0
&&;;1 3
end;;4 7
<;;8 9
r;;: ;
.;;; <
TimeEnd;;< C
.;;C D
	TimeOfDay;;D M
);;M N
||;;O Q
(<< 
start<< 
<<< 
r<< 
.<< 
	TimeStart<< (
.<<( )
	TimeOfDay<<) 2
&&<<3 5
end<<6 9
><<: ;
r<<< =
.<<= >
	TimeStart<<> G
.<<G H
	TimeOfDay<<H Q
)<<Q R
||<<S U
(== 
start== 
>== 
r== 
.== 
TimeEnd== &
.==& '
	TimeOfDay==' 0
&&==1 3
end==4 7
<==8 9
r==: ;
.==; <
TimeEnd==< C
.==C D
	TimeOfDay==D M
)==M N
)==N O
return==P V
false==W \
;==\ ]
}>> 
return?? 
true?? 
;?? 
}@@ 	
publicBB 
voidBB 
CreateReservationBB %
(BB% &
ReservationBB& 1
reservationBB2 =
)BB= >
{CC 	
CreateDD 
(DD 
reservationDD 
)DD 
;DD  
}EE 	
publicPP 
voidPP 
UpdateReservationPP %
(PP% &
ReservationPP& 1
dbReservationPP2 ?
,PP? @
ReservationPPA L
reservationPPM X
)PPX Y
{QQ 	
reservationRR 
.RR 
IdRR 
=RR 
dbReservationRR *
.RR* +
IdRR+ -
;RR- .
dbReservationSS 
.SS 
MapSS 
(SS 
reservationSS )
)SS) *
;SS* +
UpdateTT 
(TT 
dbReservationTT  
)TT  !
;TT! "
}UU 	
publicWW 
voidWW 
DeleteReservationWW %
(WW% &
ReservationWW& 1
reservationWW2 =
)WW= >
{XX 	
DeleteYY 
(YY 
reservationYY 
)YY 
;YY  
}ZZ 	
}[[ 
}\\ 
XC:\Users\Kamile\source\repos\BeautySalon\Repository\ReservationsHasServicesRepository.cs
	namespace 	

Repository
 
{ 
public 

class -
!ReservationsHasServicesRepository 2
:3 4
RepositoryBase5 C
<C D#
ReservationsHasServicesD [
>[ \
{ 
public -
!ReservationsHasServicesRepository 0
(0 1
RepositoryContext1 B
repositoryContextC T
)T U
:V W
baseX \
(\ ]
repositoryContext] n
)n o
{ 	
} 	
} 
} ï
HC:\Users\Kamile\source\repos\BeautySalon\Repository\ServiceRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
ServiceRepository "
:" #
RepositoryBase$ 2
<2 3
Service3 :
>: ;
,; <
IServiceRepository= O
{ 
public 
ServiceRepository  
(  !
RepositoryContext! 2
repositoryContext3 D
)D E
:F G
baseG K
(K L
repositoryContextL ]
)] ^
{ 	
} 	
public 
IEnumerable 
< 
Service "
>" #!
ServicesByReservation$ 9
(9 :
int: =
masterId> F
)F G
{ 	
return 
FindByCondition "
(" #
a# $
=>% '
a( )
.) *
MasterId* 2
.2 3
Equals3 9
(9 :
masterId: B
)B C
)C D
.D E
ToListE K
(K L
)L M
;M N
} 	
public 
IEnumerable 
< 
Service "
>" #
GetAllServices$ 2
(2 3
)3 4
{ 	
return 
FindAll 
( 
) 
. 
OrderBy $
($ %
x% &
=>' )
x* +
.+ ,
Id, .
). /
./ 0
ToList0 6
(6 7
)7 8
;8 9
} 	
[ 	
HttpGet	 
( 
$str 
, 
Name 
= 
nameof  &
(& '
GetServiceById' 5
)5 6
)6 7
]7 8
public   
Service   
GetServiceById   %
(  % &
int  & )
	serviceId  * 3
)  3 4
{!! 	
return"" 
FindByCondition"" "
(""" #
service""# *
=>""+ -
service"". 5
.""5 6
Id""6 8
.""8 9
Equals""9 ?
(""? @
	serviceId""@ I
)""I J
)""J K
.""K L
DefaultIfEmpty""L Z
(""Z [
new""[ ^
Service""_ f
(""f g
)""g h
)""h i
.""i j
FirstOrDefault""j x
(""x y
)""y z
;""z {
}## 	
public%% 
IEnumerable%% 
<%% 
Service%% "
>%%" #
GetServicesByMaster%%$ 7
(%%7 8
int%%8 ;
masterId%%< D
)%%D E
{&& 	
return'' 
FindByCondition'' "
(''" #
service''# *
=>''+ -
service''. 5
.''5 6
MasterId''6 >
.''> ?
Equals''? E
(''E F
masterId''F N
)''N O
)''O P
.''P Q
ToList''Q W
(''W X
)''X Y
;''Y Z
}(( 	
public** 
void** 
CreateService** !
(**! "
Service**" )
service*** 1
)**1 2
{++ 	
Create,, 
(,, 
service,, 
),, 
;,, 
}-- 	
public00 
void00 
UpdateService00 !
(00! "
Service00" )
	dbService00* 3
,003 4
Service005 <
service00= D
)00D E
{11 	
	dbService22 
.22 
Map22 
(22 
service22 !
)22! "
;22" #
Update33 
(33 
	dbService33 
)33 
;33 
}44 	
public66 
void66 
DeleteService66 !
(66! "
Service66" )
service66* 1
)661 2
{77 	
Delete88 
(88 
service88 
)88 
;88 
}99 	
}:: 
};; Ù<
JC:\Users\Kamile\source\repos\BeautySalon\Repository\TimetableRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
TimetableRepository $
:$ %
RepositoryBase& 4
<4 5
	Timetable5 >
>> ?
,? @ 
ITimetableRepositoryA U
{ 
public 
TimetableRepository "
(" #
RepositoryContext# 4
repositoryContext5 F
)F G
:H I
baseI M
(M N
repositoryContextN _
)_ `
{ 	
} 	
public 
IEnumerable 
< 
	Timetable $
>$ %
GetAllTimetables& 6
(6 7
)7 8
{ 	
return 
FindAll 
( 
) 
. 
OrderBy $
($ %
x% &
=>' )
x* +
.+ ,
Id, .
). /
./ 0
ToList0 6
(6 7
)7 8
;8 9
} 	
[ 	
HttpGet	 
( 
$str 
, 
Name 
= 
nameof  &
(& '
GetTimetableById' 7
)7 8
)8 9
]9 :
public 
	Timetable 
GetTimetableById )
() *
int* -
timetableId. 9
)9 :
{ 	
return 
FindByCondition "
(" #
	timetable# ,
=>- /
	timetable0 9
.9 :
Id: <
.< =
Equals= C
(C D
timetableIdD O
)O P
)P Q
.Q R
DefaultIfEmptyR `
(` a
newa d
	Timetablee n
(n o
)o p
)p q
.q r
FirstOrDefault	r 
(
 
)
 
;
 
} 	
public   
IEnumerable   
<   
	Timetable   $
>  $ %!
GetTimetablesByMaster  & ;
(  ; <
int  < ?
masterId  @ H
)  H I
{!! 	
return"" 
FindByCondition"" "
(""" #
	timetable""# ,
=>""- /
	timetable""0 9
.""9 :
MasterId"": B
.""B C
Equals""C I
(""I J
masterId""J R
)""R S
)""S T
.""T U
ToList""U [
(""[ \
)""\ ]
;""] ^
}## 	
public%% 
	Timetable%% +
GetTimetableByMasterAndDateTime%% 8
(%%8 9
int%%9 <
masterId%%= E
,%%E F
DateTime%%G O
date%%P T
,%%T U
TimeSpan%%V ^
start%%_ d
,%%d e
TimeSpan%%f n
end%%o r
)%%r s
{&& 	
IEnumerable'' 
<'' 
	Timetable'' !
>''! "

timetables''# -
=''. /(
GetTimetablesByMasterAndDate''0 L
(''L M
masterId''M U
,''U V
date''W [
)''[ \
;''\ ]
foreach(( 
((( 
	Timetable(( 
tb(( !
in((" $

timetables((% /
)((/ 0
{)) 
if** 
(** 
tb** 
.** 
	TimeStart**  
<=**! #
start**$ )
&&*** ,
tb**- /
.**/ 0
TimeEnd**0 7
>=**8 :
end**; >
)**> ?
return**@ F
tb**G I
;**I J
}++ 
return,, 
null,, 
;,, 
}-- 	
public// 
IEnumerable// 
<// 
	Timetable// $
>//$ %(
GetTimetablesByMasterAndDate//& B
(//B C
int//C F
masterId//G O
,//O P
DateTime//Q Y
date//Z ^
)//^ _
{00 	
return11 
FindByCondition11 "
(11" #
	timetable11# ,
=>11- /
	timetable110 9
.119 :
MasterId11: B
.11B C
Equals11C I
(11I J
masterId11J R
)11R S
&&11T V
	timetable11W `
.11` a
Date11a e
.11e f
Equals11f l
(11l m
date11m q
.11q r
Date11r v
)11v w
)11w x
.11x y
ToList11y 
(	11 
)
11 
;
11 
}22 	
public44 
bool44 
IsValid44 
(44 
	Timetable44 %
	timetable44& /
)44/ 0
{55 	
if66 
(66 
	timetable66 
.66 
	TimeStart66 #
>66$ %
	timetable66& /
.66/ 0
TimeEnd660 7
)667 8
return669 ?
false66@ E
;66E F
var77 
tbs77 
=77 (
GetTimetablesByMasterAndDate77 2
(772 3
	timetable773 <
.77< =
MasterId77= E
,77E F
	timetable77G P
.77P Q
Date77Q U
)77U V
;77V W
foreach88 
(88 
	Timetable88 
tb88  
in88! #
tbs88$ '
)88' (
{99 
if:: 
(:: 
(:: 
	timetable:: 
.:: 
	TimeStart:: (
<::) *
tb::+ -
.::- .
TimeEnd::. 5
&&::6 8
	timetable::9 B
.::B C
	TimeStart::C L
>::M N
tb::O Q
.::Q R
	TimeStart::R [
)::[ \
||::] _
(;; 
	timetable;; 
.;; 
TimeEnd;; &
<;;' (
tb;;) +
.;;+ ,
TimeEnd;;, 3
&&;;4 6
	timetable;;7 @
.;;@ A
TimeEnd;;A H
>;;I J
tb;;K M
.;;M N
	TimeStart;;N W
);;W X
||;;Y [
(<< 
	timetable<< 
.<< 
	TimeStart<< (
<<<) *
tb<<+ -
.<<- .
TimeEnd<<. 5
&&<<6 8
	timetable<<9 B
.<<B C
TimeEnd<<C J
><<K L
tb<<M O
.<<O P
TimeEnd<<P W
)<<W X
||<<Y [
(== 
	timetable== 
.== 
	TimeStart== (
<==) *
tb==+ -
.==- .
	TimeStart==. 7
&&==8 :
	timetable==; D
.==D E
TimeEnd==E L
>==M N
tb==O Q
.==Q R
	TimeStart==R [
)==[ \
)==\ ]
return==^ d
false==e j
;==j k
}>> 
return?? 
true?? 
;?? 
}@@ 	
publicBB 
voidBB 
CreateTimetableBB #
(BB# $
	TimetableBB$ -
	timetableBB. 7
)BB7 8
{CC 	
CreateDD 
(DD 
	timetableDD 
)DD 
;DD 
}EE 	
publicGG 
voidGG 
UpdateTimetableGG #
(GG# $
	TimetableGG$ -
dbTimetableGG. 9
,GG9 :
	TimetableGG; D
	timetableGGE N
)GGN O
{HH 	
dbTimetableJJ 
.JJ 
MapJJ 
(JJ 
	timetableJJ %
)JJ% &
;JJ& '
UpdateKK 
(KK 
dbTimetableKK 
)KK 
;KK  
}LL 	
publicNN 
voidNN 
DeleteTimetableNN #
(NN# $
	TimetableNN$ -
	timetableNN. 7
)NN7 8
{OO 	
DeletePP 
(PP 
	timetablePP 
)PP 
;PP 
}QQ 	
}RR 
}SS B
EC:\Users\Kamile\source\repos\BeautySalon\Repository\UserRepository.cs
	namespace 	

Repository
 
{ 
public 

class 
UserRepository 
:  !
RepositoryBase" 0
<0 1
User1 5
>5 6
,6 7
IUserRepository8 G
{ 
public 
UserRepository 
( 
RepositoryContext /
repositoryContext0 A
)A B
: 
base 
( 
repositoryContext #
)# $
{ 	
} 	
public 
IEnumerable 
< 
User 
>  
GetAllUsers! ,
(, -
)- .
{ 	
return 
FindAll 
( 
) 
. 
OrderBy $
($ %
x% &
=>' )
x* +
.+ ,
Id, .
). /
./ 0
ToList0 6
(6 7
)7 8
;8 9
} 	
[ 	
HttpGet	 
( 
$str 
, 
Name 
= 
nameof  &
(& '
GetUserById' 2
)2 3
)3 4
]4 5
public 
User 
GetUserById 
(  
int  #
userId$ *
)* +
{   	
return!! 
FindByCondition!! "
(!!" #
user!!# '
=>!!( *
user!!+ /
.!!/ 0
Id!!0 2
.!!2 3
Equals!!3 9
(!!9 :
userId!!: @
)!!@ A
)!!A B
.!!B C
DefaultIfEmpty!!C Q
(!!Q R
new!!R U
User!!V Z
(!!Z [
)!![ \
)!!\ ]
.!!] ^
FirstOrDefault!!^ l
(!!l m
)!!m n
;!!n o
}"" 	
public$$ 
User$$ 
GetUserByEmail$$ "
($$" #
string$$# )
email$$* /
)$$/ 0
{%% 	
return&& 
FindByCondition&& "
(&&" #
user&&# '
=>&&( *
user&&+ /
.&&/ 0
Email&&0 5
.&&5 6
Equals&&6 <
(&&< =
email&&= B
)&&B C
)&&C D
.&&D E
DefaultIfEmpty&&E S
(&&S T
new&&T W
User&&X \
(&&\ ]
)&&] ^
)&&^ _
.&&_ `
FirstOrDefault&&` n
(&&n o
)&&o p
;&&p q
}'' 	
public)) 
UserExtended)) 
GetUserWithDetails)) .
()). /
int))/ 2
userId))3 9
)))9 :
{** 	
return++ 
new++ 
UserExtended++ #
(++# $
GetUserById++$ /
(++/ 0
userId++0 6
)++6 7
)++7 8
{,, 
Reservations-- 
=-- 
RepositoryContext-- 0
.--0 1
Reservations--1 =
.--= >
Where--> C
(--C D
a--D E
=>--F H
a--I J
.--J K
UserId--K Q
==--R T
userId--U [
)--[ \
}.. 
;.. 
}// 	
public11 
IEnumerable11 
<11 
User11 
>11  
GetAllMasters11! .
(11. /
)11/ 0
{22 	
return33 
FindByCondition33 "
(33" #
user33# '
=>33( *
user33+ /
.33/ 0
UserType330 8
.338 9
Equals339 ?
(33? @
$str33@ H
)33H I
)33I J
.33J K
ToList33K Q
(33Q R
)33R S
;33S T
}44 	
public77 
IEnumerable77 
<77 
User77 
>77  
GetAllClients77! .
(77. /
)77/ 0
{88 	
return99 
FindByCondition99 "
(99" #
user99# '
=>99( *
user99+ /
.99/ 0
UserType990 8
.998 9
Equals999 ?
(99? @
$str99@ H
)99H I
)99I J
.99J K
ToList99K Q
(99Q R
)99R S
;99S T
}:: 	
public== 
IEnumerable== 
<== 
User== 
>==  
GetAllAdmins==! -
(==- .
)==. /
{>> 	
return?? 
FindByCondition?? "
(??" #
user??# '
=>??( *
user??+ /
.??/ 0
UserType??0 8
.??8 9
Equals??9 ?
(??? @
$str??@ H
)??H I
)??I J
.??J K
ToList??K Q
(??Q R
)??R S
;??S T
}@@ 	
publicBB 
voidBB 

CreateUserBB 
(BB 
UserBB #
userBB$ (
)BB( )
{CC 	
userDD 
.DD 
CreationDateDD 
=DD 
DateTimeDD  (
.DD( )
UtcNowDD) /
;DD/ 0
CreateEE 
(EE 
userEE 
)EE 
;EE 
}FF 	
publicHH 
voidHH 

UpdateUserHH 
(HH 
UserHH #
dbUserHH$ *
,HH* +
UserHH, 0
userHH1 5
)HH5 6
{II 	
dbUserJJ 
.JJ 
MapJJ 
(JJ 
userJJ 
)JJ 
;JJ 
UpdateKK 
(KK 
dbUserKK 
)KK 
;KK 
}LL 	
publicNN 
voidNN 

DeleteUserNN 
(NN 
UserNN #
userNN$ (
)NN( )
{OO 	
DeletePP 
(PP 
userPP 
)PP 
;PP 
}QQ 	
publicSS 
boolSS 
IsValidUserSS 
(SS  
stringSS  &
emailSS' ,
,SS, -
stringSS. 4
passwordSS5 =
)SS= >
{TT 	
varUU 
userUU 
=UU 
FindByConditionUU &
(UU& '
xUU' (
=>UU) +
xUU, -
.UU- .
EmailUU. 3
.UU3 4
EqualsUU4 :
(UU: ;
emailUU; @
)UU@ A
&&UUB D
xUUE F
.UUF G
PasswordUUG O
.UUO P
EqualsUUP V
(UUV W
passwordUUW _
)UU_ `
)UU` a
.UUa b
DefaultIfEmptyUUb p
(UUp q
nullUUq u
)UUu v
.UUv w
FirstOrDefault	UUw 
(
UU 
)
UU 
;
UU 
ifVV 
(VV 
userVV 
.VV 
IsObjectNullVV !
(VV! "
)VV" #
)VV# $
returnVV% +
falseVV, 1
;VV1 2
returnWW 
trueWW 
;WW 
}XX 	
private[[ 
string[[ 
ComputeSha256Hash[[ (
([[( )
string[[) /
rawData[[0 7
)[[7 8
{\\ 	
using^^ 
(^^ 
SHA256^^ 

sha256Hash^^ $
=^^% &
SHA256^^' -
.^^- .
Create^^. 4
(^^4 5
)^^5 6
)^^6 7
{__ 
byteaa 
[aa 
]aa 
bytesaa 
=aa 

sha256Hashaa )
.aa) *
ComputeHashaa* 5
(aa5 6
Encodingaa6 >
.aa> ?
UTF8aa? C
.aaC D
GetBytesaaD L
(aaL M
rawDataaaM T
)aaT U
)aaU V
;aaV W
StringBuilderdd 
builderdd %
=dd& '
newdd( +
StringBuilderdd, 9
(dd9 :
)dd: ;
;dd; <
foree 
(ee 
intee 
iee 
=ee 
$numee 
;ee 
iee  !
<ee" #
bytesee$ )
.ee) *
Lengthee* 0
;ee0 1
iee2 3
++ee3 5
)ee5 6
{ff 
buildergg 
.gg 
Appendgg "
(gg" #
bytesgg# (
[gg( )
igg) *
]gg* +
.gg+ ,
ToStringgg, 4
(gg4 5
$strgg5 9
)gg9 :
)gg: ;
;gg; <
}hh 
returnii 
builderii 
.ii 
ToStringii '
(ii' (
)ii( )
;ii) *
}jj 
}kk 	
}ll 
}mm 