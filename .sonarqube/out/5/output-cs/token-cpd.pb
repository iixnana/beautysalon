Üâ
UC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\ArticleController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ArticleController "
:# $
ControllerBase% 3
{ 
private 
ILoggerManager 
_logger &
;& '
private 
IRepositoryWrapper "
_repository# .
;. /
private 
readonly 
IAuthService %
_authService& 2
;2 3
public 
ArticleController  
(  !
ILoggerManager! /
logger0 6
,6 7
IRepositoryWrapper8 J

repositoryK U
,U V
IAuthServiceW c
authServiced o
)o p
{ 	
_logger 
= 
logger 
; 
_repository 
= 

repository $
;$ %
_authService 
= 
authService &
;& '
} 	
[ 	
AllowAnonymous	 
] 
[ 	
HttpGet	 
] 
public 
IActionResult 
GetAllArticles +
(+ ,
), -
{ 	
try   
{!! 
var"" 
articles"" 
="" 
_repository"" *
.""* +
Article""+ 2
.""2 3
GetAllArticles""3 A
(""A B
)""B C
;""C D
_logger$$ 
.$$ 
LogInfo$$ 
($$  
$"$$  "0
$Returned all articles from database.$$" F
"$$F G
)$$G H
;$$H I
return&& 
Ok&& 
(&& 
articles&& "
)&&" #
;&&# $
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
_logger** 
.** 
LogError**  
(**  !
$"**! #?
3Something went wrong inside GetAllArticles action: **# V
{**V W
ex**W Y
.**Y Z
Message**Z a
}**a b
"**b c
)**c d
;**d e
return++ 
NotFound++ 
(++  
)++  !
;++! "
},, 
}-- 	
[// 	
AllowAnonymous//	 
]// 
[00 	
HttpGet00	 
(00 
$str00 
)00 
]00  
public11 
IActionResult11 
GetArticlesByAuthor11 0
(110 1
int111 4
id115 7
)117 8
{22 	
try33 
{44 
var55 
articles55 
=55 
_repository55 *
.55* +
Article55+ 2
.552 3
GetArticlesByMaster553 F
(55F G
id55G I
)55I J
;55J K
_logger77 
.77 
LogInfo77 
(77  
$"77  "0
$Returned all articles from database.77" F
"77F G
)77G H
;77H I
return99 
Ok99 
(99 
articles99 "
)99" #
;99# $
}:: 
catch;; 
(;; 
	Exception;; 
ex;; 
);;  
{<< 
_logger== 
.== 
LogError==  
(==  !
$"==! #?
3Something went wrong inside GetAllArticles action: ==# V
{==V W
ex==W Y
.==Y Z
Message==Z a
}==a b
"==b c
)==c d
;==d e
return>> 
NotFound>> 
(>>  
)>>  !
;>>! "
}?? 
}@@ 	
[BB 	
AllowAnonymousBB	 
]BB 
[CC 	
HttpGetCC	 
(CC 
$strCC 
)CC 
]CC 
publicDD 
IActionResultDD 
GetArticleByIdDD +
(DD+ ,
intDD, /
idDD0 2
)DD2 3
{EE 	
tryFF 
{GG 
varHH 
articleHH 
=HH 
_repositoryHH )
.HH) *
ArticleHH* 1
.HH1 2
GetArticleByIdHH2 @
(HH@ A
idHHA C
)HHC D
;HHD E
ifJJ 
(JJ 
articleJJ 
.JJ 
IsEmptyObjectJJ )
(JJ) *
idJJ* ,
)JJ, -
)JJ- .
{KK 
_loggerLL 
.LL 
LogErrorLL $
(LL$ %
$"LL% '
Article with id: LL' 8
{LL8 9
idLL9 ;
}LL; <&
, hasn't been found in db.LL< V
"LLV W
)LLW X
;LLX Y
returnMM 
NotFoundMM #
(MM# $
)MM$ %
;MM% &
}NN 
elseOO 
{PP 
_loggerQQ 
.QQ 
LogInfoQQ #
(QQ# $
$"QQ$ &&
Returned article with id: QQ& @
{QQ@ A
idQQA C
}QQC D
"QQD E
)QQE F
;QQF G
returnRR 
OkRR 
(RR 
articleRR %
)RR% &
;RR& '
}SS 
}TT 
catchUU 
(UU 
	ExceptionUU 
exUU 
)UU  
{VV 
_loggerWW 
.WW 
LogErrorWW  
(WW  !
$"WW! #?
3Something went wrong inside GetArticleById action: WW# V
{WWV W
exWWW Y
.WWY Z
MessageWWZ a
}WWa b
"WWb c
)WWc d
;WWd e
returnXX 

StatusCodeXX !
(XX! "
$numXX" %
,XX% &
$strXX' >
)XX> ?
;XX? @
}YY 
}ZZ 	
[\\ 	
	Authorize\\	 
(\\ 
Roles\\ 
=\\ 
Role\\ 
.\\  
Master\\  &
)\\& '
]\\' (
[]] 	
HttpPost]]	 
]]] 
public^^ 
IActionResult^^ 
CreateArticle^^ *
(^^* +
[^^+ ,
FromBody^^, 4
]^^4 5
Article^^5 <
article^^= D
)^^D E
{__ 	
try`` 
{aa 
ifcc 
(cc 
articlecc 
.cc 
IsObjectNullcc (
(cc( )
)cc) *
)cc* +
{dd 
_loggeree 
.ee 
LogErroree $
(ee$ %
$stree% O
)eeO P
;eeP Q
returnff 

BadRequestff %
(ff% &
$strff& >
)ff> ?
;ff? @
}gg 
ifii 
(ii 
_authServiceii  
.ii  !
IsMasterii! )
(ii) *
Requestii* 1
.ii1 2
Headersii2 9
[ii9 :
$strii: I
]iiI J
)iiJ K
&&iiL N
_authServiceiiO [
.ii[ \
GetIdii\ a
(iia b
Requestiib i
.iii j
Headersiij q
[iiq r
$str	iir Å
]
iiÅ Ç
)
iiÇ É
!=
iiÑ Ü
article
iiá é
.
iié è
UserId
iiè ï
)
iiï ñ
{jj 
_loggerkk 
.kk 
LogErrorkk $
(kk$ %
$"kk% '
User with id: kk' 5
{kk5 6
_authServicekk6 B
.kkB C
GetIdkkC H
(kkH I
RequestkkI P
.kkP Q
HeaderskkQ X
[kkX Y
$strkkY h
]kkh i
)kki j
}kkj kD
7, has tried to access restricted data in CreateArticle.	kkk ¢
"
kk¢ £
)
kk£ §
;
kk§ •
returnll 
Unauthorizedll '
(ll' (
)ll( )
;ll) *
}mm 
ifoo 
(oo 
!oo 

ModelStateoo 
.oo  
IsValidoo  '
)oo' (
{pp 
_loggerqq 
.qq 
LogErrorqq $
(qq$ %
$strqq% O
)qqO P
;qqP Q
returnrr 

BadRequestrr %
(rr% &
$strrr& <
)rr< =
;rr= >
}ss 
_repositoryuu 
.uu 
Articleuu #
.uu# $
CreateArticleuu$ 1
(uu1 2
articleuu2 9
)uu9 :
;uu: ;
_repositoryvv 
.vv 
Savevv  
(vv  !
)vv! "
;vv" #
returnxx 
Okxx 
(xx 
articlexx !
)xx! "
;xx" #
}{{ 
catch|| 
(|| 
	Exception|| 
ex|| 
)||  
{}} 
_logger~~ 
.~~ 
LogError~~  
(~~  !
$"~~! #>
2Something went wrong inside CreateArticle action: ~~# U
{~~U V
ex~~V X
.~~X Y
Message~~Y `
}~~` a
"~~a b
)~~b c
;~~c d
return 

StatusCode !
(! "
$num" %
,% &
$str' >
)> ?
;? @
}
ÄÄ 
}
ÅÅ 	
[
ÉÉ 	
	Authorize
ÉÉ	 
(
ÉÉ 
Roles
ÉÉ 
=
ÉÉ 
Role
ÉÉ 
.
ÉÉ  
MasterAdmin
ÉÉ  +
)
ÉÉ+ ,
]
ÉÉ, -
[
ÑÑ 	
HttpPut
ÑÑ	 
(
ÑÑ 
$str
ÑÑ 
)
ÑÑ 
]
ÑÑ 
public
ÖÖ 
IActionResult
ÖÖ 
UpdateArticle
ÖÖ *
(
ÖÖ* +
int
ÖÖ+ .
id
ÖÖ/ 1
,
ÖÖ1 2
[
ÖÖ3 4
FromBody
ÖÖ4 <
]
ÖÖ< =
Article
ÖÖ= D
article
ÖÖE L
)
ÖÖL M
{
ÜÜ 	
try
áá 
{
àà 
if
ââ 
(
ââ 
article
ââ 
.
ââ 
IsObjectNull
ââ (
(
ââ( )
)
ââ) *
)
ââ* +
{
ää 
_logger
ãã 
.
ãã 
LogError
ãã $
(
ãã$ %
$str
ãã% O
)
ããO P
;
ããP Q
return
åå 

BadRequest
åå %
(
åå% &
$str
åå& >
)
åå> ?
;
åå? @
}
çç 
if
èè 
(
èè 
_authService
èè  
.
èè  !
IsMaster
èè! )
(
èè) *
Request
èè* 1
.
èè1 2
Headers
èè2 9
[
èè9 :
$str
èè: I
]
èèI J
)
èèJ K
&&
èèL N
_authService
èèO [
.
èè[ \
GetId
èè\ a
(
èèa b
Request
èèb i
.
èèi j
Headers
èèj q
[
èèq r
$strèèr Å
]èèÅ Ç
)èèÇ É
!=èèÑ Ü
articleèèá é
.èèé è
UserIdèèè ï
)èèï ñ
{
êê 
_logger
ëë 
.
ëë 
LogError
ëë $
(
ëë$ %
$"
ëë% '
User with id: 
ëë' 5
{
ëë5 6
_authService
ëë6 B
.
ëëB C
GetId
ëëC H
(
ëëH I
Request
ëëI P
.
ëëP Q
Headers
ëëQ X
[
ëëX Y
$str
ëëY h
]
ëëh i
)
ëëi j
}
ëëj kF
7, has tried to access restricted data in UpdateArticle.ëëk ¢
"ëë¢ £
)ëë£ §
;ëë§ •
return
íí 
Unauthorized
íí '
(
íí' (
)
íí( )
;
íí) *
}
ìì 
if
ïï 
(
ïï 
!
ïï 

ModelState
ïï 
.
ïï  
IsValid
ïï  '
)
ïï' (
{
ññ 
_logger
óó 
.
óó 
LogError
óó $
(
óó$ %
$str
óó% O
)
óóO P
;
óóP Q
return
òò 

BadRequest
òò %
(
òò% &
$str
òò& <
)
òò< =
;
òò= >
}
ôô 
var
õõ 
	dbArticle
õõ 
=
õõ 
_repository
õõ  +
.
õõ+ ,
Article
õõ, 3
.
õõ3 4
GetArticleById
õõ4 B
(
õõB C
id
õõC E
)
õõE F
;
õõF G
if
úú 
(
úú 
	dbArticle
úú 
.
úú 
IsEmptyObject
úú +
(
úú+ ,
id
úú, .
)
úú. /
)
úú/ 0
{
ùù 
_logger
ûû 
.
ûû 
LogError
ûû $
(
ûû$ %
$"
ûû% '
Article with id: 
ûû' 8
{
ûû8 9
id
ûû9 ;
}
ûû; <(
, hasn't been found in db.
ûû< V
"
ûûV W
)
ûûW X
;
ûûX Y
return
üü 
NotFound
üü #
(
üü# $
)
üü$ %
;
üü% &
}
†† 
_repository
¢¢ 
.
¢¢ 
Article
¢¢ #
.
¢¢# $
UpdateArticle
¢¢$ 1
(
¢¢1 2
	dbArticle
¢¢2 ;
,
¢¢; <
article
¢¢= D
)
¢¢D E
;
¢¢E F
_repository
££ 
.
££ 
Save
££  
(
££  !
)
££! "
;
££" #
return
•• 
	NoContent
••  
(
••  !
)
••! "
;
••" #
}
¶¶ 
catch
ßß 
(
ßß 
	Exception
ßß 
ex
ßß 
)
ßß  
{
®® 
_logger
©© 
.
©© 
LogError
©©  
(
©©  !
$"
©©! #@
2Something went wrong inside UpdateArticle action: 
©©# U
{
©©U V
ex
©©V X
.
©©X Y
Message
©©Y `
}
©©` a
"
©©a b
)
©©b c
;
©©c d
return
™™ 

StatusCode
™™ !
(
™™! "
$num
™™" %
,
™™% &
$str
™™' >
)
™™> ?
;
™™? @
}
´´ 
}
¨¨ 	
[
ÆÆ 	
	Authorize
ÆÆ	 
(
ÆÆ 
Roles
ÆÆ 
=
ÆÆ 
Role
ÆÆ 
.
ÆÆ  
MasterAdmin
ÆÆ  +
)
ÆÆ+ ,
]
ÆÆ, -
[
ØØ 	

HttpDelete
ØØ	 
(
ØØ 
$str
ØØ 
)
ØØ 
]
ØØ 
public
∞∞ 
IActionResult
∞∞ 
DeleteArticle
∞∞ *
(
∞∞* +
int
∞∞+ .
id
∞∞/ 1
)
∞∞1 2
{
±± 	
try
≤≤ 
{
≥≥ 
var
¥¥ 
article
¥¥ 
=
¥¥ 
_repository
¥¥ )
.
¥¥) *
Article
¥¥* 1
.
¥¥1 2
GetArticleById
¥¥2 @
(
¥¥@ A
id
¥¥A C
)
¥¥C D
;
¥¥D E
if
µµ 
(
µµ 
article
µµ 
.
µµ 
IsEmptyObject
µµ )
(
µµ) *
id
µµ* ,
)
µµ, -
)
µµ- .
{
∂∂ 
_logger
∑∑ 
.
∑∑ 
LogError
∑∑ $
(
∑∑$ %
$"
∑∑% '
Article with id: 
∑∑' 8
{
∑∑8 9
id
∑∑9 ;
}
∑∑; <(
, hasn't been found in db.
∑∑< V
"
∑∑V W
)
∑∑W X
;
∑∑X Y
return
∏∏ 
NotFound
∏∏ #
(
∏∏# $
)
∏∏$ %
;
∏∏% &
}
ππ 
if
ªª 
(
ªª 
_authService
ªª  
.
ªª  !
IsMaster
ªª! )
(
ªª) *
Request
ªª* 1
.
ªª1 2
Headers
ªª2 9
[
ªª9 :
$str
ªª: I
]
ªªI J
)
ªªJ K
&&
ªªL N
_authService
ªªO [
.
ªª[ \
GetId
ªª\ a
(
ªªa b
Request
ªªb i
.
ªªi j
Headers
ªªj q
[
ªªq r
$strªªr Å
]ªªÅ Ç
)ªªÇ É
!=ªªÑ Ü
articleªªá é
.ªªé è
UserIdªªè ï
)ªªï ñ
{
ºº 
_logger
ΩΩ 
.
ΩΩ 
LogError
ΩΩ $
(
ΩΩ$ %
$"
ΩΩ% '
User with id: 
ΩΩ' 5
{
ΩΩ5 6
_authService
ΩΩ6 B
.
ΩΩB C
GetId
ΩΩC H
(
ΩΩH I
Request
ΩΩI P
.
ΩΩP Q
Headers
ΩΩQ X
[
ΩΩX Y
$str
ΩΩY h
]
ΩΩh i
)
ΩΩi j
}
ΩΩj kF
7, has tried to access restricted data in DeleteArticle.ΩΩk ¢
"ΩΩ¢ £
)ΩΩ£ §
;ΩΩ§ •
return
ææ 
Unauthorized
ææ '
(
ææ' (
)
ææ( )
;
ææ) *
}
øø 
_repository
¡¡ 
.
¡¡ 
Article
¡¡ #
.
¡¡# $
DeleteArticle
¡¡$ 1
(
¡¡1 2
article
¡¡2 9
)
¡¡9 :
;
¡¡: ;
_repository
¬¬ 
.
¬¬ 
Save
¬¬  
(
¬¬  !
)
¬¬! "
;
¬¬" #
return
ƒƒ 
	NoContent
ƒƒ  
(
ƒƒ  !
)
ƒƒ! "
;
ƒƒ" #
}
≈≈ 
catch
∆∆ 
(
∆∆ 
	Exception
∆∆ 
ex
∆∆ 
)
∆∆  
{
«« 
_logger
»» 
.
»» 
LogError
»»  
(
»»  !
$"
»»! #@
2Something went wrong inside DeleteArticle action: 
»»# U
{
»»U V
ex
»»V X
.
»»X Y
Message
»»Y `
}
»»` a
"
»»a b
)
»»b c
;
»»c d
return
…… 

StatusCode
…… !
(
……! "
$num
……" %
,
……% &
$str
……' >
)
……> ?
;
……? @
}
   
}
ÀÀ 	
}
ÃÃ 
}ÕÕ Ÿ#
RC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\AuthController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IAuthService %
_authService& 2
;2 3
private 
ILoggerManager 
_logger &
;& '
public 
AuthController 
( 
ILoggerManager ,
logger- 3
,3 4
IAuthService5 A
authServiceB M
)M N
{ 	
_authService 
= 
authService &
;& '
_logger 
= 
logger 
; 
} 	
[ 	
AllowAnonymous	 
] 
[ 	
HttpPost	 
, 
Route 
( 
$str "
)" #
]# $
public 
IActionResult 
RequestToken )
() *
[* +
FromBody+ 3
]3 4
AuthData4 <
request= D
)D E
{ 	
try 
{ 
if   
(   
request   
==   
null   #
)  # $
return  % +

BadRequest  , 6
(  6 7
$str  7 O
)  O P
;  P Q
string"" 
token"" 
;"" 
if## 
(## 
_authService##  
.##  !
IsAuthenticated##! 0
(##0 1
request##1 8
,##8 9
out##: =
token##> C
)##C D
)##D E
{$$ 
_logger%% 
.%% 
LogInfo%% #
(%%# $
$"%%$ &
Token generated.%%& 6
"%%6 7
)%%7 8
;%%8 9
return&& 
Ok&& 
(&& 
token&& #
)&&# $
;&&$ %
}'' 
_logger(( 
.(( 
LogInfo(( 
(((  
$"((  "
Invalid data.((" /
"((/ 0
)((0 1
;((1 2
return)) 
Unauthorized)) #
())# $
)))$ %
;))% &
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
_logger-- 
.-- 
LogError--  
(--  !
$"--! #=
1Something went wrong inside RequestToken method: --# T
{--T U
ex--U W
.--W X
Message--X _
}--_ `
"--` a
)--a b
;--b c
return.. 

StatusCode.. !
(..! "
$num.." %
,..% &
$str..' >
)..> ?
;..? @
}// 
}00 	
[22 	
HttpGet22	 
]22 
public33 
IActionResult33 
	ReadToken33 &
(33& '
)33' (
{44 	
try55 
{66 
string77 
receivedToken77 $
=77% &
Request77' .
.77. /
Headers77/ 6
[776 7
$str777 F
]77F G
;77G H
var88 
token88 
=88 
_authService88 (
.88( )
	ReadToken88) 2
(882 3
receivedToken883 @
)88@ A
;88A B
_logger99 
.99 
LogInfo99 
(99  
$"99  "
Authorized token.99" 3
"993 4
)994 5
;995 6
return:: 
Ok:: 
(:: 
token:: 
.::  
Payload::  '
)::' (
;::( )
};; 
catch<< 
(<< 
	Exception<< 
ex<< 
)<< 
{== 
_logger>> 
.>> 
LogError>>  
(>>  !
$">>! #
Bad token: >># .
{>>. /
ex>>/ 1
.>>1 2
Message>>2 9
}>>9 :
{>>; <
Request>>< C
.>>C D
Headers>>D K
[>>K L
$str>>L [
]>>[ \
}>>\ ]
">>] ^
)>>^ _
;>>_ `
return?? 
Unauthorized?? #
(??# $
)??$ %
;??% &
}@@ 
}AA 	
}BB 
}CC ﬁœ
YC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\ReservationController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class !
ReservationController &
:' (

Controller) 3
{ 
private 
readonly 
IAuthService %
_authService& 2
;2 3
private 
ILoggerManager 
_logger &
;& '
private 
IRepositoryWrapper "
_repository# .
;. /
public !
ReservationController $
($ %
ILoggerManager% 3
logger4 :
,: ;
IRepositoryWrapper< N

repositoryO Y
,Y Z
IAuthService[ g
authServiceh s
)s t
{ 	
_logger 
= 
logger 
; 
_repository 
= 

repository $
;$ %
_authService 
= 
authService &
;& '
} 	
[ 	
	Authorize	 
( 
Roles 
= 
Role 
.  
Admin  %
)% &
]& '
[ 	
HttpGet	 
] 
public   
IActionResult   
GetAllReservations   /
(  / 0
)  0 1
{!! 	
try"" 
{## 
var$$ 
reservations$$  
=$$! "
_repository$$# .
.$$. /
Reservation$$/ :
.$$: ;
GetAllReservations$$; M
($$M N
)$$N O
;$$O P
if%% 
(%% 
reservations%%  
.%%  !
Any%%! $
(%%$ %
)%%% &
)%%& '
{&& 
_logger'' 
.'' 
LogInfo'' #
(''# $
$"''$ &4
(Returned all reservations from database.''& N
"''N O
)''O P
;''P Q
return)) 
Ok)) 
()) 
reservations)) *
)))* +
;))+ ,
}** 
else++ 
{,, 
return-- 
NotFound-- #
(--# $
)--$ %
;--% &
}.. 
}// 
catch00 
(00 
	Exception00 
ex00 
)00  
{11 
_logger22 
.22 
LogError22  
(22  !
$"22! #C
7Something went wrong inside GetAllReservations action: 22# Z
{22Z [
ex22[ ]
.22] ^
Message22^ e
}22e f
"22f g
)22g h
;22h i
return33 

StatusCode33 !
(33! "
$num33" %
,33% &
$str33' >
)33> ?
;33? @
}44 
}55 	
[77 	
AllowAnonymous77	 
]77 
[88 	
HttpGet88	 
(88 
$str88 
)88 
]88  
public99 
IActionResult99 #
GetReservationsByMaster99 4
(994 5
int995 8
id999 ;
)99; <
{:: 	
try;; 
{<< 
var== 
reservations==  
===! "
_repository==# .
.==. /
Reservation==/ :
.==: ;#
GetReservationsByMaster==; R
(==R S
id==S U
)==U V
;==V W
if>> 
(>> 
reservations>>  
.>>  !
Any>>! $
(>>$ %
)>>% &
)>>& '
{?? 
_logger@@ 
.@@ 
LogInfo@@ #
(@@# $
$"@@$ &4
(Returned all reservations from database.@@& N
"@@N O
)@@O P
;@@P Q
returnBB 
OkBB 
(BB 
reservationsBB *
)BB* +
;BB+ ,
}CC 
elseDD 
{EE 
returnFF 
NotFoundFF #
(FF# $
)FF$ %
;FF% &
}GG 
}HH 
catchII 
(II 
	ExceptionII 
exII 
)II  
{JJ 
_loggerKK 
.KK 
LogErrorKK  
(KK  !
$"KK! #C
7Something went wrong inside GetAllReservations action: KK# Z
{KKZ [
exKK[ ]
.KK] ^
MessageKK^ e
}KKe f
"KKf g
)KKg h
;KKh i
returnLL 

StatusCodeLL !
(LL! "
$numLL" %
,LL% &
$strLL' >
)LL> ?
;LL? @
}MM 
}NN 	
[PP 	
	AuthorizePP	 
(PP 
RolesPP 
=PP 
RolePP 
.PP  
ClientMasterAdminPP  1
)PP1 2
]PP2 3
[QQ 	
HttpGetQQ	 
(QQ 
$strQQ 
)QQ 
]QQ 
publicRR 
IActionResultRR !
GetReservationsByUserRR 2
(RR2 3
intRR3 6
idRR7 9
)RR9 :
{SS 	
tryTT 
{UU 
ifVV 
(VV 
_authServiceVV  
.VV  !
IsClientVV! )
(VV) *
RequestVV* 1
.VV1 2
HeadersVV2 9
[VV9 :
$strVV: I
]VVI J
)VVJ K
&&VVL N
_authServiceVVO [
.VV[ \
GetIdVV\ a
(VVa b
RequestVVb i
.VVi j
HeadersVVj q
[VVq r
$str	VVr Å
]
VVÅ Ç
)
VVÇ É
!=
VVÑ Ü
id
VVá â
)
VVâ ä
{WW 
_loggerXX 
.XX 
LogErrorXX $
(XX$ %
$"XX% '
User with id: XX' 5
{XX5 6
idXX6 8
}XX8 9K
?, has tried to access restricted data in GetReservationsByUser.XX9 x
"XXx y
)XXy z
;XXz {
returnYY 
UnauthorizedYY '
(YY' (
)YY( )
;YY) *
}ZZ 
var\\ 
reservations\\  
=\\! "
_repository\\# .
.\\. /
Reservation\\/ :
.\\: ;!
GetReservationsByUser\\; P
(\\P Q
id\\Q S
)\\S T
;\\T U
if]] 
(]] 
reservations]]  
.]]  !
Any]]! $
(]]$ %
)]]% &
)]]& '
{^^ 
_logger__ 
.__ 
LogInfo__ #
(__# $
$"__$ &4
(Returned all reservations from database.__& N
"__N O
)__O P
;__P Q
returnaa 
Okaa 
(aa 
reservationsaa *
)aa* +
;aa+ ,
}bb 
elsecc 
{dd 
returnee 
NotFoundee #
(ee# $
)ee$ %
;ee% &
}ff 
}gg 
catchhh 
(hh 
	Exceptionhh 
exhh 
)hh  
{ii 
_loggerjj 
.jj 
LogErrorjj  
(jj  !
$"jj! #C
7Something went wrong inside GetAllReservations action: jj# Z
{jjZ [
exjj[ ]
.jj] ^
Messagejj^ e
}jje f
"jjf g
)jjg h
;jjh i
returnkk 

StatusCodekk !
(kk! "
$numkk" %
,kk% &
$strkk' >
)kk> ?
;kk? @
}ll 
}mm 	
[rr 	
	Authorizerr	 
(rr 
Rolesrr 
=rr 
Rolerr 
.rr  
ClientMasterAdminrr  1
)rr1 2
]rr2 3
[ss 	
HttpGetss	 
(ss 
$strss 
)ss 
]ss 
publictt 
IActionResulttt 
GetReservationByIdtt /
(tt/ 0
inttt0 3
idtt4 6
)tt6 7
{uu 	
tryvv 
{ww 
varxx 
reservationxx 
=xx  !
_repositoryxx" -
.xx- .
Reservationxx. 9
.xx9 :
GetReservationByIdxx: L
(xxL M
idxxM O
)xxO P
;xxP Q
ifzz 
(zz 
_authServicezz  
.zz  !
IsClientzz! )
(zz) *
Requestzz* 1
.zz1 2
Headerszz2 9
[zz9 :
$strzz: I
]zzI J
)zzJ K
&&zzL N
_authServicezzO [
.zz[ \
GetIdzz\ a
(zza b
Requestzzb i
.zzi j
Headerszzj q
[zzq r
$str	zzr Å
]
zzÅ Ç
)
zzÇ É
!=
zzÑ Ü
reservation
zzá í
.
zzí ì
UserId
zzì ô
)
zzô ö
{{{ 
_logger|| 
.|| 
LogError|| $
(||$ %
$"||% '
User with id: ||' 5
{||5 6
id||6 8
}||8 9I
=, has tried to access restricted data in GetReservationsById.||9 v
"||v w
)||w x
;||x y
return}} 
Unauthorized}} '
(}}' (
)}}( )
;}}) *
}~~ 
if
ÄÄ 
(
ÄÄ 
_authService
ÄÄ  
.
ÄÄ  !
IsMaster
ÄÄ! )
(
ÄÄ) *
Request
ÄÄ* 1
.
ÄÄ1 2
Headers
ÄÄ2 9
[
ÄÄ9 :
$str
ÄÄ: I
]
ÄÄI J
)
ÄÄJ K
&&
ÄÄL N
_authService
ÄÄO [
.
ÄÄ[ \
GetId
ÄÄ\ a
(
ÄÄa b
Request
ÄÄb i
.
ÄÄi j
Headers
ÄÄj q
[
ÄÄq r
$strÄÄr Å
]ÄÄÅ Ç
)ÄÄÇ É
!=ÄÄÑ Ü
reservationÄÄá í
.ÄÄí ì
MasterIdÄÄì õ
)ÄÄõ ú
{
ÅÅ 
_logger
ÇÇ 
.
ÇÇ 
LogError
ÇÇ $
(
ÇÇ$ %
$"
ÇÇ% '
User with id: 
ÇÇ' 5
{
ÇÇ5 6
id
ÇÇ6 8
}
ÇÇ8 9K
=, has tried to access restricted data in GetReservationsById.
ÇÇ9 v
"
ÇÇv w
)
ÇÇw x
;
ÇÇx y
return
ÉÉ 
Unauthorized
ÉÉ '
(
ÉÉ' (
)
ÉÉ( )
;
ÉÉ) *
}
ÑÑ 
if
ÜÜ 
(
ÜÜ 
reservation
ÜÜ 
.
ÜÜ  
IsEmptyObject
ÜÜ  -
(
ÜÜ- .
id
ÜÜ. 0
)
ÜÜ0 1
)
ÜÜ1 2
{
áá 
_logger
àà 
.
àà 
LogError
àà $
(
àà$ %
$"
àà% '#
Reservation with id: 
àà' <
{
àà< =
id
àà= ?
}
àà? @(
, hasn't been found in db.
àà@ Z
"
ààZ [
)
àà[ \
;
àà\ ]
return
ââ 
NotFound
ââ #
(
ââ# $
)
ââ$ %
;
ââ% &
}
ää 
else
ãã 
{
åå 
_logger
çç 
.
çç 
LogInfo
çç #
(
çç# $
$"
çç$ &,
Returned reservation with id: 
çç& D
{
ççD E
id
ççE G
}
ççG H
"
ççH I
)
ççI J
;
ççJ K
return
éé 
Ok
éé 
(
éé 
reservation
éé )
)
éé) *
;
éé* +
}
èè 
}
êê 
catch
ëë 
(
ëë 
	Exception
ëë 
ex
ëë 
)
ëë  
{
íí 
_logger
ìì 
.
ìì 
LogError
ìì  
(
ìì  !
$"
ìì! #E
7Something went wrong inside GetReservationById action: 
ìì# Z
{
ììZ [
ex
ìì[ ]
.
ìì] ^
Message
ìì^ e
}
ììe f
"
ììf g
)
ììg h
;
ììh i
return
îî 

StatusCode
îî !
(
îî! "
$num
îî" %
,
îî% &
$str
îî' >
)
îî> ?
;
îî? @
}
ïï 
}
ññ 	
[
ôô 	
	Authorize
ôô	 
(
ôô 
Roles
ôô 
=
ôô 
Role
ôô 
.
ôô  
Client
ôô  &
)
ôô& '
]
ôô' (
[
öö 	
HttpPost
öö	 
]
öö 
public
õõ 
IActionResult
õõ 
CreateReservation
õõ .
(
õõ. /
[
õõ/ 0
FromBody
õõ0 8
]
õõ8 9
Reservation
õõ9 D
reservation
õõE P
)
õõP Q
{
úú 	
try
ùù 
{
ûû 
var
üü 
IdFromToken
üü 
=
üü  !
_authService
üü" .
.
üü. /
GetId
üü/ 4
(
üü4 5
Request
üü5 <
.
üü< =
Headers
üü= D
[
üüD E
$str
üüE T
]
üüT U
)
üüU V
;
üüV W
if
†† 
(
†† 
IdFromToken
†† 
!=
††  "
reservation
††# .
.
††. /
UserId
††/ 5
)
††5 6
{
°° 
_logger
¢¢ 
.
¢¢ 
LogError
¢¢ $
(
¢¢$ %
$"
¢¢% '
User with id: 
¢¢' 5
{
¢¢5 6
IdFromToken
¢¢6 A
}
¢¢A B9
+, has tried to create reservation for user 
¢¢B m
{
¢¢m n
reservation
¢¢n y
.
¢¢y z
UserId¢¢z Ä
}¢¢Ä Å
.¢¢Å Ç
"¢¢Ç É
)¢¢É Ñ
;¢¢Ñ Ö
return
££ 
Unauthorized
££ '
(
££' (
)
££( )
;
££) *
}
§§ 
reservation
•• 
.
•• 
Status
•• "
=
••# $
$str
••% .
;
••. /
reservation
¶¶ 
.
¶¶ 
ApprovedByUser
¶¶ *
=
¶¶+ ,
false
¶¶- 2
;
¶¶2 3
if
®® 
(
®® 
reservation
®® 
.
®®  
IsObjectNull
®®  ,
(
®®, -
)
®®- .
)
®®. /
{
©© 
_logger
™™ 
.
™™ 
LogError
™™ $
(
™™$ %
$str
™™% S
)
™™S T
;
™™T U
return
´´ 

BadRequest
´´ %
(
´´% &
$str
´´& B
)
´´B C
;
´´C D
}
¨¨ 
if
ÆÆ 
(
ÆÆ 
!
ÆÆ 

ModelState
ÆÆ 
.
ÆÆ  
IsValid
ÆÆ  '
||
ÆÆ( *
reservation
ÆÆ+ 6
.
ÆÆ6 7
	TimeStart
ÆÆ7 @
.
ÆÆ@ A
Date
ÆÆA E
!=
ÆÆF H
reservation
ÆÆI T
.
ÆÆT U
TimeEnd
ÆÆU \
.
ÆÆ\ ]
Date
ÆÆ] a
||
ØØ 
_repository
ØØ "
.
ØØ" #
	Timetable
ØØ# ,
.
ØØ, --
GetTimetableByMasterAndDateTime
ØØ- L
(
ØØL M
reservation
ØØM X
.
ØØX Y
MasterId
ØØY a
,
ØØa b
reservation
ØØc n
.
ØØn o
	TimeStart
ØØo x
.
ØØx y
Date
ØØy }
,
ØØ} ~
reservationØØ ä
.ØØä ã
	TimeStartØØã î
.ØØî ï
	TimeOfDayØØï û
,ØØû ü
reservationØØ† ´
.ØØ´ ¨
TimeEndØØ¨ ≥
.ØØ≥ ¥
	TimeOfDayØØ¥ Ω
)ØØΩ æ
.ØØæ ø
IsObjectNullØØø À
(ØØÀ Ã
)ØØÃ Õ
||
∞∞ 
!
∞∞ 
_repository
∞∞ #
.
∞∞# $
Reservation
∞∞$ /
.
∞∞/ 0
IsValid
∞∞0 7
(
∞∞7 8
reservation
∞∞8 C
.
∞∞C D
MasterId
∞∞D L
,
∞∞L M
reservation
∞∞N Y
.
∞∞Y Z
	TimeStart
∞∞Z c
.
∞∞c d
Date
∞∞d h
,
∞∞h i
reservation
∞∞j u
.
∞∞u v
	TimeStart
∞∞v 
.∞∞ Ä
	TimeOfDay∞∞Ä â
,∞∞â ä
reservation∞∞ã ñ
.∞∞ñ ó
TimeEnd∞∞ó û
.∞∞û ü
	TimeOfDay∞∞ü ®
)∞∞® ©
)∞∞© ™
{
±± 
_logger
≤≤ 
.
≤≤ 
LogError
≤≤ $
(
≤≤$ %
$str
≤≤% S
)
≤≤S T
;
≤≤T U
return
≥≥ 

BadRequest
≥≥ %
(
≥≥% &
$str
≥≥& <
)
≥≥< =
;
≥≥= >
}
¥¥ 
_repository
∂∂ 
.
∂∂ 
Reservation
∂∂ '
.
∂∂' (
CreateReservation
∂∂( 9
(
∂∂9 :
reservation
∂∂: E
)
∂∂E F
;
∂∂F G
_repository
∑∑ 
.
∑∑ 
Save
∑∑  
(
∑∑  !
)
∑∑! "
;
∑∑" #
return
ππ 
Ok
ππ 
(
ππ 
reservation
ππ %
)
ππ% &
;
ππ& '
}
∫∫ 
catch
ªª 
(
ªª 
	Exception
ªª 
ex
ªª 
)
ªª  
{
ºº 
_logger
ΩΩ 
.
ΩΩ 
LogError
ΩΩ  
(
ΩΩ  !
$"
ΩΩ! #D
6Something went wrong inside CreateReservation action: 
ΩΩ# Y
{
ΩΩY Z
ex
ΩΩZ \
.
ΩΩ\ ]
Message
ΩΩ] d
}
ΩΩd e
"
ΩΩe f
)
ΩΩf g
;
ΩΩg h
return
ææ 

StatusCode
ææ !
(
ææ! "
$num
ææ" %
,
ææ% &
$str
ææ' >
)
ææ> ?
;
ææ? @
}
øø 
}
¿¿ 	
[
√√ 	
	Authorize
√√	 
(
√√ 
Roles
√√ 
=
√√ 
Role
√√ 
.
√√  
ClientMaster
√√  ,
)
√√, -
]
√√- .
[
ƒƒ 	
HttpPut
ƒƒ	 
(
ƒƒ 
$str
ƒƒ 
)
ƒƒ 
]
ƒƒ 
public
≈≈ 
IActionResult
≈≈ 
UpdateReservation
≈≈ .
(
≈≈. /
int
≈≈/ 2
id
≈≈3 5
,
≈≈5 6
[
≈≈7 8
FromBody
≈≈8 @
]
≈≈@ A
Reservation
≈≈A L
reservation
≈≈M X
)
≈≈X Y
{
∆∆ 	
try
«« 
{
»» 
if
…… 
(
…… 
reservation
…… 
.
……  
IsObjectNull
……  ,
(
……, -
)
……- .
)
……. /
{
   
_logger
ÀÀ 
.
ÀÀ 
LogError
ÀÀ $
(
ÀÀ$ %
$str
ÀÀ% S
)
ÀÀS T
;
ÀÀT U
return
ÃÃ 

BadRequest
ÃÃ %
(
ÃÃ% &
$str
ÃÃ& B
)
ÃÃB C
;
ÃÃC D
}
ÕÕ 
if
œœ 
(
œœ 
_authService
œœ  
.
œœ  !
IsClient
œœ! )
(
œœ) *
Request
œœ* 1
.
œœ1 2
Headers
œœ2 9
[
œœ9 :
$str
œœ: I
]
œœI J
)
œœJ K
&&
œœL N
_authService
œœO [
.
œœ[ \
GetId
œœ\ a
(
œœa b
Request
œœb i
.
œœi j
Headers
œœj q
[
œœq r
$strœœr Å
]œœÅ Ç
)œœÇ É
!=œœÑ Ü
reservationœœá í
.œœí ì
UserIdœœì ô
)œœô ö
{
–– 
_logger
—— 
.
—— 
LogError
—— $
(
——$ %
$"
——% '
User with id: 
——' 5
{
——5 6
id
——6 8
}
——8 9I
;, has tried to access restricted data in UpdateReservation.
——9 t
"
——t u
)
——u v
;
——v w
return
““ 
Unauthorized
““ '
(
““' (
)
““( )
;
““) *
}
”” 
if
’’ 
(
’’ 
!
’’ 

ModelState
’’ 
.
’’  
IsValid
’’  '
||
’’( *
reservation
’’+ 6
.
’’6 7
	TimeStart
’’7 @
.
’’@ A
Date
’’A E
!=
’’F H
reservation
’’I T
.
’’T U
TimeEnd
’’U \
.
’’\ ]
Date
’’] a
||
÷÷ 
_repository
÷÷ "
.
÷÷" #
	Timetable
÷÷# ,
.
÷÷, --
GetTimetableByMasterAndDateTime
÷÷- L
(
÷÷L M
reservation
÷÷M X
.
÷÷X Y
MasterId
÷÷Y a
,
÷÷a b
reservation
÷÷c n
.
÷÷n o
	TimeStart
÷÷o x
.
÷÷x y
Date
÷÷y }
,
÷÷} ~
reservation÷÷ ä
.÷÷ä ã
	TimeStart÷÷ã î
.÷÷î ï
	TimeOfDay÷÷ï û
,÷÷û ü
reservation÷÷† ´
.÷÷´ ¨
TimeEnd÷÷¨ ≥
.÷÷≥ ¥
	TimeOfDay÷÷¥ Ω
)÷÷Ω æ
.÷÷æ ø
IsObjectNull÷÷ø À
(÷÷À Ã
)÷÷Ã Õ
||
◊◊ 
!
◊◊ 
_repository
◊◊ #
.
◊◊# $
Reservation
◊◊$ /
.
◊◊/ 0
IsValid
◊◊0 7
(
◊◊7 8
reservation
◊◊8 C
.
◊◊C D
MasterId
◊◊D L
,
◊◊L M
reservation
◊◊N Y
.
◊◊Y Z
	TimeStart
◊◊Z c
.
◊◊c d
Date
◊◊d h
,
◊◊h i
reservation
◊◊j u
.
◊◊u v
	TimeStart
◊◊v 
.◊◊ Ä
	TimeOfDay◊◊Ä â
,◊◊â ä
reservation◊◊ã ñ
.◊◊ñ ó
TimeEnd◊◊ó û
.◊◊û ü
	TimeOfDay◊◊ü ®
)◊◊® ©
)◊◊© ™
{
ÿÿ 
_logger
ŸŸ 
.
ŸŸ 
LogError
ŸŸ $
(
ŸŸ$ %
$str
ŸŸ% S
)
ŸŸS T
;
ŸŸT U
return
⁄⁄ 

BadRequest
⁄⁄ %
(
⁄⁄% &
$str
⁄⁄& <
)
⁄⁄< =
;
⁄⁄= >
}
€€ 
var
›› 
dbReservation
›› !
=
››" #
_repository
››$ /
.
››/ 0
Reservation
››0 ;
.
››; < 
GetReservationById
››< N
(
››N O
id
››O Q
)
››Q R
;
››R S
if
ﬁﬁ 
(
ﬁﬁ 
dbReservation
ﬁﬁ !
.
ﬁﬁ! "
IsEmptyObject
ﬁﬁ" /
(
ﬁﬁ/ 0
id
ﬁﬁ0 2
)
ﬁﬁ2 3
)
ﬁﬁ3 4
{
ﬂﬂ 
_logger
‡‡ 
.
‡‡ 
LogError
‡‡ $
(
‡‡$ %
$"
‡‡% '#
Reservation with id: 
‡‡' <
{
‡‡< =
id
‡‡= ?
}
‡‡? @(
, hasn't been found in db.
‡‡@ Z
"
‡‡Z [
)
‡‡[ \
;
‡‡\ ]
return
·· 
NotFound
·· #
(
··# $
)
··$ %
;
··% &
}
‚‚ 
_repository
‰‰ 
.
‰‰ 
Reservation
‰‰ '
.
‰‰' (
UpdateReservation
‰‰( 9
(
‰‰9 :
dbReservation
‰‰: G
,
‰‰G H
reservation
‰‰I T
)
‰‰T U
;
‰‰U V
_repository
ÂÂ 
.
ÂÂ 
Save
ÂÂ  
(
ÂÂ  !
)
ÂÂ! "
;
ÂÂ" #
return
ÁÁ 
	NoContent
ÁÁ  
(
ÁÁ  !
)
ÁÁ! "
;
ÁÁ" #
}
ËË 
catch
ÈÈ 
(
ÈÈ 
	Exception
ÈÈ 
ex
ÈÈ 
)
ÈÈ  
{
ÍÍ 
_logger
ÎÎ 
.
ÎÎ 
LogError
ÎÎ  
(
ÎÎ  !
$"
ÎÎ! #D
6Something went wrong inside UpdateReservation action: 
ÎÎ# Y
{
ÎÎY Z
ex
ÎÎZ \
.
ÎÎ\ ]
Message
ÎÎ] d
}
ÎÎd e
"
ÎÎe f
)
ÎÎf g
;
ÎÎg h
return
ÏÏ 

StatusCode
ÏÏ !
(
ÏÏ! "
$num
ÏÏ" %
,
ÏÏ% &
$str
ÏÏ' >
)
ÏÏ> ?
;
ÏÏ? @
}
ÌÌ 
}
ÓÓ 	
[
ÒÒ 	
	Authorize
ÒÒ	 
(
ÒÒ 
Roles
ÒÒ 
=
ÒÒ 
Role
ÒÒ 
.
ÒÒ  
Client
ÒÒ  &
)
ÒÒ& '
]
ÒÒ' (
[
ÚÚ 	

HttpDelete
ÚÚ	 
(
ÚÚ 
$str
ÚÚ 
)
ÚÚ 
]
ÚÚ 
public
ÛÛ 
IActionResult
ÛÛ 
DeleteReservation
ÛÛ .
(
ÛÛ. /
int
ÛÛ/ 2
id
ÛÛ3 5
)
ÛÛ5 6
{
ÙÙ 	
try
ıı 
{
ˆˆ 
var
˜˜ 
reservation
˜˜ 
=
˜˜  !
_repository
˜˜" -
.
˜˜- .
Reservation
˜˜. 9
.
˜˜9 : 
GetReservationById
˜˜: L
(
˜˜L M
id
˜˜M O
)
˜˜O P
;
˜˜P Q
if
¯¯ 
(
¯¯ 
reservation
¯¯ 
.
¯¯  
IsEmptyObject
¯¯  -
(
¯¯- .
id
¯¯. 0
)
¯¯0 1
)
¯¯1 2
{
˘˘ 
_logger
˙˙ 
.
˙˙ 
LogError
˙˙ $
(
˙˙$ %
$"
˙˙% '#
Reservation with id: 
˙˙' <
{
˙˙< =
id
˙˙= ?
}
˙˙? @(
, hasn't been found in db.
˙˙@ Z
"
˙˙Z [
)
˙˙[ \
;
˙˙\ ]
return
˚˚ 
NotFound
˚˚ #
(
˚˚# $
)
˚˚$ %
;
˚˚% &
}
¸¸ 
if
˛˛ 
(
˛˛ 
_authService
˛˛  
.
˛˛  !
GetId
˛˛! &
(
˛˛& '
Request
˛˛' .
.
˛˛. /
Headers
˛˛/ 6
[
˛˛6 7
$str
˛˛7 F
]
˛˛F G
)
˛˛G H
!=
˛˛I K
reservation
˛˛L W
.
˛˛W X
UserId
˛˛X ^
)
˛˛^ _
{
ˇˇ 
_logger
ÄÄ 
.
ÄÄ 
LogError
ÄÄ $
(
ÄÄ$ %
$"
ÄÄ% '
User with id: 
ÄÄ' 5
{
ÄÄ5 6
id
ÄÄ6 8
}
ÄÄ8 9I
;, has tried to access restricted data in DeleteReservation.
ÄÄ9 t
"
ÄÄt u
)
ÄÄu v
;
ÄÄv w
return
ÅÅ 
Unauthorized
ÅÅ '
(
ÅÅ' (
)
ÅÅ( )
;
ÅÅ) *
}
ÇÇ 
_repository
ÑÑ 
.
ÑÑ 
Reservation
ÑÑ '
.
ÑÑ' (
DeleteReservation
ÑÑ( 9
(
ÑÑ9 :
reservation
ÑÑ: E
)
ÑÑE F
;
ÑÑF G
_repository
ÖÖ 
.
ÖÖ 
Save
ÖÖ  
(
ÖÖ  !
)
ÖÖ! "
;
ÖÖ" #
return
áá 
	NoContent
áá  
(
áá  !
)
áá! "
;
áá" #
}
àà 
catch
ââ 
(
ââ 
	Exception
ââ 
ex
ââ 
)
ââ  
{
ää 
_logger
ãã 
.
ãã 
LogError
ãã  
(
ãã  !
$"
ãã! #D
6Something went wrong inside DeleteReservation action: 
ãã# Y
{
ããY Z
ex
ããZ \
.
ãã\ ]
Message
ãã] d
}
ããd e
"
ããe f
)
ããf g
;
ããg h
return
åå 

StatusCode
åå !
(
åå! "
$num
åå" %
,
åå% &
$str
åå' >
)
åå> ?
;
åå? @
}
çç 
}
éé 	
}
èè 
}êê êá
UC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\ServiceController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ServiceController "
:# $
ControllerBase% 3
{ 
private 
ILoggerManager 
_logger &
;& '
private 
IRepositoryWrapper "
_repository# .
;. /
private 
readonly 
IAuthService %
_authService& 2
;2 3
public 
ServiceController  
(  !
ILoggerManager! /
logger0 6
,6 7
IRepositoryWrapper8 J

repositoryK U
,U V
IAuthServiceW c
authServiced o
)o p
{ 	
_logger 
= 
logger 
; 
_repository 
= 

repository $
;$ %
_authService 
= 
authService &
;& '
} 	
[ 	
HttpGet	 
] 
public 
IActionResult 
GetAllServices +
(+ ,
), -
{ 	
try 
{   
var!! 
services!! 
=!! 
_repository!! *
.!!* +
Service!!+ 2
.!!2 3
GetAllServices!!3 A
(!!A B
)!!B C
;!!C D
_logger## 
.## 
LogInfo## 
(##  
$"##  "0
$Returned all services from database.##" F
"##F G
)##G H
;##H I
return%% 
Ok%% 
(%% 
services%% "
)%%" #
;%%# $
}&& 
catch'' 
('' 
	Exception'' 
ex'' 
)''  
{(( 
_logger)) 
.)) 
LogError))  
())  !
$"))! #?
3Something went wrong inside GetAllServices action: ))# V
{))V W
ex))W Y
.))Y Z
Message))Z a
}))a b
"))b c
)))c d
;))d e
return** 
NotFound** 
(**  
)**  !
;**! "
}++ 
},, 	
[.. 	
HttpGet..	 
(.. 
$str.. 
).. 
].. 
public// 
IActionResult// 
GetServiceById// +
(//+ ,
int//, /
id//0 2
)//2 3
{00 	
try11 
{22 
var33 
service33 
=33 
_repository33 )
.33) *
Service33* 1
.331 2
GetServiceById332 @
(33@ A
id33A C
)33C D
;33D E
if55 
(55 
service55 
.55 
IsEmptyObject55 )
(55) *
id55* ,
)55, -
)55- .
{66 
_logger77 
.77 
LogError77 $
(77$ %
$"77% '
Service with id: 77' 8
{778 9
id779 ;
}77; <&
, hasn't been found in db.77< V
"77V W
)77W X
;77X Y
return88 
NotFound88 #
(88# $
)88$ %
;88% &
}99 
else:: 
{;; 
_logger<< 
.<< 
LogInfo<< #
(<<# $
$"<<$ &&
Returned service with id: <<& @
{<<@ A
id<<A C
}<<C D
"<<D E
)<<E F
;<<F G
return== 
Ok== 
(== 
service== %
)==% &
;==& '
}>> 
}?? 
catch@@ 
(@@ 
	Exception@@ 
ex@@ 
)@@  
{AA 
_loggerBB 
.BB 
LogErrorBB  
(BB  !
$"BB! #?
3Something went wrong inside GetServiceById action: BB# V
{BBV W
exBBW Y
.BBY Z
MessageBBZ a
}BBa b
"BBb c
)BBc d
;BBd e
returnCC 

StatusCodeCC !
(CC! "
$numCC" %
,CC% &
$strCC' >
)CC> ?
;CC? @
}DD 
}EE 	
[GG 	
AllowAnonymousGG	 
]GG 
[HH 	
HttpGetHH	 
(HH 
$strHH 
)HH 
]HH  
publicII 
IActionResultII 
GetServicesByMasterII 0
(II0 1
intII1 4
idII5 7
)II7 8
{JJ 	
tryKK 
{LL 
varMM 
servicesMM 
=MM 
_repositoryMM *
.MM* +
ServiceMM+ 2
.MM2 3
GetServicesByMasterMM3 F
(MMF G
idMMG I
)MMI J
;MMJ K
_loggerOO 
.OO 
LogInfoOO 
(OO  
$"OO  ".
"Returned services with master id: OO" D
{OOD E
idOOE G
}OOG H
"OOH I
)OOI J
;OOJ K
returnPP 
OkPP 
(PP 
servicesPP "
)PP" #
;PP# $
}QQ 
catchRR 
(RR 
	ExceptionRR 
exRR 
)RR  
{SS 
_loggerTT 
.TT 
LogErrorTT  
(TT  !
$"TT! #?
3Something went wrong inside GetServiceById action: TT# V
{TTV W
exTTW Y
.TTY Z
MessageTTZ a
}TTa b
"TTb c
)TTc d
;TTd e
returnUU 

StatusCodeUU !
(UU! "
$numUU" %
,UU% &
$strUU' >
)UU> ?
;UU? @
}VV 
}WW 	
[YY 	
	AuthorizeYY	 
(YY 
RolesYY 
=YY 
RoleYY 
.YY  
MasterYY  &
)YY& '
]YY' (
[ZZ 	
HttpPostZZ	 
]ZZ 
public[[ 
IActionResult[[ 
CreateService[[ *
([[* +
[[[+ ,
FromBody[[, 4
][[4 5
Service[[5 <
service[[= D
)[[D E
{\\ 	
try]] 
{^^ 
if`` 
(`` 
service`` 
.`` 
IsObjectNull`` (
(``( )
)``) *
)``* +
{aa 
_loggerbb 
.bb 
LogErrorbb $
(bb$ %
$strbb% O
)bbO P
;bbP Q
returncc 

BadRequestcc %
(cc% &
$strcc& >
)cc> ?
;cc? @
}dd 
ifff 
(ff 
_authServiceff  
.ff  !
GetIdff! &
(ff& '
Requestff' .
.ff. /
Headersff/ 6
[ff6 7
$strff7 F
]ffF G
)ffG H
!=ffI K
serviceffL S
.ffS T
MasterIdffT \
)ff\ ]
{gg 
_loggerhh 
.hh 
LogErrorhh $
(hh$ %
$"hh% '
User with id: hh' 5
{hh5 6
_authServicehh6 B
.hhB C
GetIdhhC H
(hhH I
RequesthhI P
.hhP Q
HeadershhQ X
[hhX Y
$strhhY h
]hhh i
)hhi j
}hhj kD
7, has tried to access restricted data in CreateService.	hhk ¢
"
hh¢ £
)
hh£ §
;
hh§ •
returnii 
Unauthorizedii '
(ii' (
)ii( )
;ii) *
}jj 
ifll 
(ll 
!ll 

ModelStatell 
.ll  
IsValidll  '
)ll' (
{mm 
_loggernn 
.nn 
LogErrornn $
(nn$ %
$strnn% O
)nnO P
;nnP Q
returnoo 

BadRequestoo %
(oo% &
$stroo& <
)oo< =
;oo= >
}pp 
_repositoryrr 
.rr 
Servicerr #
.rr# $
CreateServicerr$ 1
(rr1 2
servicerr2 9
)rr9 :
;rr: ;
_repositoryss 
.ss 
Savess  
(ss  !
)ss! "
;ss" #
returnuu 
Okuu 
(uu 
serviceuu !
)uu! "
;uu" #
}xx 
catchyy 
(yy 
	Exceptionyy 
exyy 
)yy  
{zz 
_logger{{ 
.{{ 
LogError{{  
({{  !
$"{{! #>
2Something went wrong inside CreateService action: {{# U
{{{U V
ex{{V X
.{{X Y
Message{{Y `
}{{` a
"{{a b
){{b c
;{{c d
return|| 

StatusCode|| !
(||! "
$num||" %
,||% &
$str||' >
)||> ?
;||? @
}}} 
}~~ 	
[
ÄÄ 	
	Authorize
ÄÄ	 
(
ÄÄ 
Roles
ÄÄ 
=
ÄÄ 
Role
ÄÄ 
.
ÄÄ  
MasterAdmin
ÄÄ  +
)
ÄÄ+ ,
]
ÄÄ, -
[
ÅÅ 	
HttpPut
ÅÅ	 
(
ÅÅ 
$str
ÅÅ 
)
ÅÅ 
]
ÅÅ 
public
ÇÇ 
IActionResult
ÇÇ 
UpdateService
ÇÇ *
(
ÇÇ* +
int
ÇÇ+ .
id
ÇÇ/ 1
,
ÇÇ1 2
[
ÇÇ3 4
FromBody
ÇÇ4 <
]
ÇÇ< =
Service
ÇÇ= D
service
ÇÇE L
)
ÇÇL M
{
ÉÉ 	
try
ÑÑ 
{
ÖÖ 
if
ÜÜ 
(
ÜÜ 
service
ÜÜ 
.
ÜÜ 
IsObjectNull
ÜÜ (
(
ÜÜ( )
)
ÜÜ) *
)
ÜÜ* +
{
áá 
_logger
àà 
.
àà 
LogError
àà $
(
àà$ %
$str
àà% O
)
ààO P
;
ààP Q
return
ââ 

BadRequest
ââ %
(
ââ% &
$str
ââ& >
)
ââ> ?
;
ââ? @
}
ää 
if
åå 
(
åå 
_authService
åå  
.
åå  !
IsMaster
åå! )
(
åå) *
Request
åå* 1
.
åå1 2
Headers
åå2 9
[
åå9 :
$str
åå: I
]
ååI J
)
ååJ K
&&
ååL N
_authService
ååO [
.
åå[ \
GetId
åå\ a
(
ååa b
Request
ååb i
.
ååi j
Headers
ååj q
[
ååq r
$stråår Å
]ååÅ Ç
)ååÇ É
!=ååÑ Ü
serviceååá é
.ååé è
MasterIdååè ó
)ååó ò
{
çç 
_logger
éé 
.
éé 
LogError
éé $
(
éé$ %
$"
éé% '
User with id: 
éé' 5
{
éé5 6
_authService
éé6 B
.
ééB C
GetId
ééC H
(
ééH I
Request
ééI P
.
ééP Q
Headers
ééQ X
[
ééX Y
$str
ééY h
]
ééh i
)
ééi j
}
ééj kF
7, has tried to access restricted data in UpdateService.éék ¢
"éé¢ £
)éé£ §
;éé§ •
return
èè 
Unauthorized
èè '
(
èè' (
)
èè( )
;
èè) *
}
êê 
if
íí 
(
íí 
!
íí 

ModelState
íí 
.
íí  
IsValid
íí  '
)
íí' (
{
ìì 
_logger
îî 
.
îî 
LogError
îî $
(
îî$ %
$str
îî% O
)
îîO P
;
îîP Q
return
ïï 

BadRequest
ïï %
(
ïï% &
$str
ïï& <
)
ïï< =
;
ïï= >
}
ññ 
var
òò 
	dbService
òò 
=
òò 
_repository
òò  +
.
òò+ ,
Service
òò, 3
.
òò3 4
GetServiceById
òò4 B
(
òòB C
id
òòC E
)
òòE F
;
òòF G
if
ôô 
(
ôô 
	dbService
ôô 
.
ôô 
IsEmptyObject
ôô +
(
ôô+ ,
id
ôô, .
)
ôô. /
)
ôô/ 0
{
öö 
_logger
õõ 
.
õõ 
LogError
õõ $
(
õõ$ %
$"
õõ% '
Service with id: 
õõ' 8
{
õõ8 9
id
õõ9 ;
}
õõ; <(
, hasn't been found in db.
õõ< V
"
õõV W
)
õõW X
;
õõX Y
return
úú 
NotFound
úú #
(
úú# $
)
úú$ %
;
úú% &
}
ùù 
_repository
üü 
.
üü 
Service
üü #
.
üü# $
UpdateService
üü$ 1
(
üü1 2
	dbService
üü2 ;
,
üü; <
service
üü= D
)
üüD E
;
üüE F
_repository
†† 
.
†† 
Save
††  
(
††  !
)
††! "
;
††" #
return
¢¢ 
	NoContent
¢¢  
(
¢¢  !
)
¢¢! "
;
¢¢" #
}
££ 
catch
§§ 
(
§§ 
	Exception
§§ 
ex
§§ 
)
§§  
{
•• 
_logger
¶¶ 
.
¶¶ 
LogError
¶¶  
(
¶¶  !
$"
¶¶! #@
2Something went wrong inside UpdateService action: 
¶¶# U
{
¶¶U V
ex
¶¶V X
.
¶¶X Y
Message
¶¶Y `
}
¶¶` a
"
¶¶a b
)
¶¶b c
;
¶¶c d
return
ßß 

StatusCode
ßß !
(
ßß! "
$num
ßß" %
,
ßß% &
$str
ßß' >
)
ßß> ?
;
ßß? @
}
®® 
}
©© 	
[
´´ 	
	Authorize
´´	 
(
´´ 
Roles
´´ 
=
´´ 
Role
´´ 
.
´´  
MasterAdmin
´´  +
)
´´+ ,
]
´´, -
[
¨¨ 	

HttpDelete
¨¨	 
(
¨¨ 
$str
¨¨ 
)
¨¨ 
]
¨¨ 
public
≠≠ 
IActionResult
≠≠ 
DeleteService
≠≠ *
(
≠≠* +
int
≠≠+ .
id
≠≠/ 1
)
≠≠1 2
{
ÆÆ 	
try
ØØ 
{
∞∞ 
var
±± 
service
±± 
=
±± 
_repository
±± )
.
±±) *
Service
±±* 1
.
±±1 2
GetServiceById
±±2 @
(
±±@ A
id
±±A C
)
±±C D
;
±±D E
if
≥≥ 
(
≥≥ 
_authService
≥≥  
.
≥≥  !
IsMaster
≥≥! )
(
≥≥) *
Request
≥≥* 1
.
≥≥1 2
Headers
≥≥2 9
[
≥≥9 :
$str
≥≥: I
]
≥≥I J
)
≥≥J K
&&
≥≥L N
_authService
≥≥O [
.
≥≥[ \
GetId
≥≥\ a
(
≥≥a b
Request
≥≥b i
.
≥≥i j
Headers
≥≥j q
[
≥≥q r
$str≥≥r Å
]≥≥Å Ç
)≥≥Ç É
!=≥≥Ñ Ü
service≥≥á é
.≥≥é è
MasterId≥≥è ó
)≥≥ó ò
{
¥¥ 
_logger
µµ 
.
µµ 
LogError
µµ $
(
µµ$ %
$"
µµ% '
User with id: 
µµ' 5
{
µµ5 6
_authService
µµ6 B
.
µµB C
GetId
µµC H
(
µµH I
Request
µµI P
.
µµP Q
Headers
µµQ X
[
µµX Y
$str
µµY h
]
µµh i
)
µµi j
}
µµj kF
7, has tried to access restricted data in CreateService.µµk ¢
"µµ¢ £
)µµ£ §
;µµ§ •
return
∂∂ 
Unauthorized
∂∂ '
(
∂∂' (
)
∂∂( )
;
∂∂) *
}
∑∑ 
if
ππ 
(
ππ 
service
ππ 
.
ππ 
IsEmptyObject
ππ )
(
ππ) *
id
ππ* ,
)
ππ, -
)
ππ- .
{
∫∫ 
_logger
ªª 
.
ªª 
LogError
ªª $
(
ªª$ %
$"
ªª% '
Service with id: 
ªª' 8
{
ªª8 9
id
ªª9 ;
}
ªª; <(
, hasn't been found in db.
ªª< V
"
ªªV W
)
ªªW X
;
ªªX Y
return
ºº 
NotFound
ºº #
(
ºº# $
)
ºº$ %
;
ºº% &
}
ΩΩ 
_repository
≈≈ 
.
≈≈ 
Service
≈≈ #
.
≈≈# $
DeleteService
≈≈$ 1
(
≈≈1 2
service
≈≈2 9
)
≈≈9 :
;
≈≈: ;
_repository
∆∆ 
.
∆∆ 
Save
∆∆  
(
∆∆  !
)
∆∆! "
;
∆∆" #
return
»» 
	NoContent
»»  
(
»»  !
)
»»! "
;
»»" #
}
…… 
catch
   
(
   
	Exception
   
ex
   
)
    
{
ÀÀ 
_logger
ÃÃ 
.
ÃÃ 
LogError
ÃÃ  
(
ÃÃ  !
$"
ÃÃ! #@
2Something went wrong inside DeleteService action: 
ÃÃ# U
{
ÃÃU V
ex
ÃÃV X
.
ÃÃX Y
Message
ÃÃY `
}
ÃÃ` a
"
ÃÃa b
)
ÃÃb c
;
ÃÃc d
return
ÕÕ 

StatusCode
ÕÕ !
(
ÕÕ! "
$num
ÕÕ" %
,
ÕÕ% &
$str
ÕÕ' >
)
ÕÕ> ?
;
ÕÕ? @
}
ŒŒ 
}
œœ 	
}
–– 
}—— ˝ë
WC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\TimetableController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
TimetableController $
:% &
ControllerBase' 5
{ 
private 
ILoggerManager 
_logger &
;& '
private 
IRepositoryWrapper "
_repository# .
;. /
private 
readonly 
IAuthService %
_authService& 2
;2 3
public 
TimetableController "
(" #
ILoggerManager# 1
logger2 8
,8 9
IRepositoryWrapper: L

repositoryM W
,W X
IAuthServiceY e
authServicef q
)q r
{ 	
_logger 
= 
logger 
; 
_repository 
= 

repository $
;$ %
_authService 
= 
authService &
;& '
} 	
[ 	
	Authorize	 
( 
Roles 
= 
Role 
.  
Admin  %
)% &
]& '
[ 	
HttpGet	 
] 
public 
IActionResult 
GetAllTimetables -
(- .
). /
{ 	
try   
{!! 
var"" 

timetables"" 
=""  
_repository""! ,
."", -
	Timetable""- 6
.""6 7
GetAllTimetables""7 G
(""G H
)""H I
;""I J
_logger$$ 
.$$ 
LogInfo$$ 
($$  
$"$$  "2
&Returned all timetables from database.$$" H
"$$H I
)$$I J
;$$J K
return&& 
Ok&& 
(&& 

timetables&& $
)&&$ %
;&&% &
}'' 
catch(( 
((( 
	Exception(( 
ex(( 
)((  
{)) 
_logger** 
.** 
LogError**  
(**  !
$"**! #A
5Something went wrong inside GetAllTimetables action: **# X
{**X Y
ex**Y [
.**[ \
Message**\ c
}**c d
"**d e
)**e f
;**f g
return++ 
NotFound++ 
(++  
)++  !
;++! "
},, 
}-- 	
[// 	
AllowAnonymous//	 
]// 
[00 	
HttpGet00	 
(00 
$str00 
)00 
]00  
public11 
IActionResult11 !
GetTimetablesByMaster11 2
(112 3
int113 6
id117 9
)119 :
{22 	
try33 
{44 
var55 

timetables55 
=55  
_repository55! ,
.55, -
	Timetable55- 6
.556 7!
GetTimetablesByMaster557 L
(55L M
id55M O
)55O P
;55P Q
_logger77 
.77 
LogInfo77 
(77  
$"77  "-
!Returned timetables by master id 77" C
{77C D
id77D F
}77F G
 from database.77G V
"77V W
)77W X
;77X Y
return99 
Ok99 
(99 

timetables99 $
)99$ %
;99% &
}:: 
catch;; 
(;; 
	Exception;; 
ex;; 
);;  
{<< 
_logger== 
.== 
LogError==  
(==  !
$"==! #A
5Something went wrong inside GetAllTimetables action: ==# X
{==X Y
ex==Y [
.==[ \
Message==\ c
}==c d
"==d e
)==e f
;==f g
return>> 
NotFound>> 
(>>  
)>>  !
;>>! "
}?? 
}@@ 	
[BB 	
	AuthorizeBB	 
(BB 
RolesBB 
=BB 
RoleBB 
.BB  
MasterAdminBB  +
)BB+ ,
]BB, -
[CC 	
HttpGetCC	 
(CC 
$strCC 
)CC 
]CC 
publicDD 
IActionResultDD 
GetTimetableByIdDD -
(DD- .
intDD. 1
idDD2 4
)DD4 5
{EE 	
tryFF 
{GG 
varHH 
	timetableHH 
=HH 
_repositoryHH  +
.HH+ ,
	TimetableHH, 5
.HH5 6
GetTimetableByIdHH6 F
(HHF G
idHHG I
)HHI J
;HHJ K
ifJJ 
(JJ 
	timetableJJ 
.JJ 
IsEmptyObjectJJ +
(JJ+ ,
idJJ, .
)JJ. /
)JJ/ 0
{KK 
_loggerLL 
.LL 
LogErrorLL $
(LL$ %
$"LL% '
Timetable with id: LL' :
{LL: ;
idLL; =
}LL= >&
, hasn't been found in db.LL> X
"LLX Y
)LLY Z
;LLZ [
returnMM 
NotFoundMM #
(MM# $
)MM$ %
;MM% &
}NN 
elseOO 
ifOO 
(OO 
_authServiceOO %
.OO% &
IsMasterOO& .
(OO. /
RequestOO/ 6
.OO6 7
HeadersOO7 >
[OO> ?
$strOO? N
]OON O
)OOO P
&&OOQ S
_authServiceOOT `
.OO` a
GetIdOOa f
(OOf g
RequestOOg n
.OOn o
HeadersOOo v
[OOv w
$str	OOw Ü
]
OOÜ á
)
OOá à
!=
OOâ ã
	timetable
OOå ï
.
OOï ñ
MasterId
OOñ û
)
OOû ü
{PP 
_loggerQQ 
.QQ 
LogErrorQQ $
(QQ$ %
$"QQ% '
User with id: QQ' 5
{QQ5 6
idQQ6 8
}QQ8 9F
:, has tried to access restricted data in GetTimetableById.QQ9 s
"QQs t
)QQt u
;QQu v
returnRR 
UnauthorizedRR '
(RR' (
)RR( )
;RR) *
}SS 
elseTT 
{UU 
_loggerVV 
.VV 
LogInfoVV #
(VV# $
$"VV$ &(
Returned timetable with id: VV& B
{VVB C
idVVC E
}VVE F
"VVF G
)VVG H
;VVH I
returnWW 
OkWW 
(WW 
	timetableWW '
)WW' (
;WW( )
}XX 
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
exZZ 
)ZZ  
{[[ 
_logger\\ 
.\\ 
LogError\\  
(\\  !
$"\\! #A
5Something went wrong inside GetTimetableById action: \\# X
{\\X Y
ex\\Y [
.\\[ \
Message\\\ c
}\\c d
"\\d e
)\\e f
;\\f g
return]] 

StatusCode]] !
(]]! "
$num]]" %
,]]% &
$str]]' >
)]]> ?
;]]? @
}^^ 
}__ 	
[aa 	
	Authorizeaa	 
(aa 
Rolesaa 
=aa 
Roleaa 
.aa  
Masteraa  &
)aa& '
]aa' (
[bb 	
HttpPostbb	 
]bb 
publiccc 
IActionResultcc 
CreateTimetablecc ,
(cc, -
[cc- .
FromBodycc. 6
]cc6 7
	Timetablecc7 @
	timetableccA J
)ccJ K
{dd 	
tryee 
{ff 
ifhh 
(hh 
	timetablehh 
.hh 
IsObjectNullhh *
(hh* +
)hh+ ,
)hh, -
{ii 
_loggerjj 
.jj 
LogErrorjj $
(jj$ %
$strjj% Q
)jjQ R
;jjR S
returnkk 

BadRequestkk %
(kk% &
$strkk& @
)kk@ A
;kkA B
}ll 
ifnn 
(nn 
!nn 

ModelStatenn 
.nn  
IsValidnn  '
||nn( *
!nn+ ,
_repositorynn, 7
.nn7 8
	Timetablenn8 A
.nnA B
IsValidnnB I
(nnI J
	timetablennJ S
)nnS T
)nnT U
{oo 
_loggerpp 
.pp 
LogErrorpp $
(pp$ %
$strpp% Q
)ppQ R
;ppR S
returnqq 

BadRequestqq %
(qq% &
$strqq& <
)qq< =
;qq= >
}rr 
_repositorytt 
.tt 
	Timetablett %
.tt% &
CreateTimetablett& 5
(tt5 6
	timetablett6 ?
)tt? @
;tt@ A
_repositoryuu 
.uu 
Saveuu  
(uu  !
)uu! "
;uu" #
returnww 
Okww 
(ww 
	timetableww #
)ww# $
;ww$ %
}zz 
catch{{ 
({{ 
	Exception{{ 
ex{{ 
){{  
{|| 
_logger}} 
.}} 
LogError}}  
(}}  !
$"}}! #@
4Something went wrong inside CreateTimetable action: }}# W
{}}W X
ex}}X Z
.}}Z [
Message}}[ b
}}}b c
"}}c d
)}}d e
;}}e f
return~~ 

StatusCode~~ !
(~~! "
$num~~" %
,~~% &
$str~~' >
)~~> ?
;~~? @
} 
}
ÄÄ 	
[
ÇÇ 	
	Authorize
ÇÇ	 
(
ÇÇ 
Roles
ÇÇ 
=
ÇÇ 
Role
ÇÇ 
.
ÇÇ  
Master
ÇÇ  &
)
ÇÇ& '
]
ÇÇ' (
[
ÉÉ 	
HttpPut
ÉÉ	 
(
ÉÉ 
$str
ÉÉ 
)
ÉÉ 
]
ÉÉ 
public
ÑÑ 
IActionResult
ÑÑ 
UpdateTimetable
ÑÑ ,
(
ÑÑ, -
int
ÑÑ- 0
id
ÑÑ1 3
,
ÑÑ3 4
[
ÑÑ5 6
FromBody
ÑÑ6 >
]
ÑÑ> ?
	Timetable
ÑÑ? H
	timetable
ÑÑI R
)
ÑÑR S
{
ÖÖ 	
try
ÜÜ 
{
áá 
if
àà 
(
àà 
	timetable
àà 
.
àà 
IsObjectNull
àà *
(
àà* +
)
àà+ ,
)
àà, -
{
ââ 
_logger
ää 
.
ää 
LogError
ää $
(
ää$ %
$str
ää% Q
)
ääQ R
;
ääR S
return
ãã 

BadRequest
ãã %
(
ãã% &
$str
ãã& @
)
ãã@ A
;
ããA B
}
åå 
if
éé 
(
éé 
_authService
éé  
.
éé  !
IsMaster
éé! )
(
éé) *
Request
éé* 1
.
éé1 2
Headers
éé2 9
[
éé9 :
$str
éé: I
]
ééI J
)
ééJ K
&&
ééL N
_authService
ééO [
.
éé[ \
GetId
éé\ a
(
ééa b
Request
ééb i
.
ééi j
Headers
ééj q
[
ééq r
$stréér Å
]ééÅ Ç
)ééÇ É
!=ééÑ Ü
	timetableééá ê
.ééê ë
MasterIdééë ô
)ééô ö
{
èè 
_logger
êê 
.
êê 
LogError
êê $
(
êê$ %
$"
êê% '
User with id: 
êê' 5
{
êê5 6
id
êê6 8
}
êê8 9G
9, has tried to access restricted data in DeleteTimetable.
êê9 r
"
êêr s
)
êês t
;
êêt u
return
ëë 
Unauthorized
ëë '
(
ëë' (
)
ëë( )
;
ëë) *
}
íí 
if
îî 
(
îî 
!
îî 

ModelState
îî 
.
îî  
IsValid
îî  '
)
îî' (
{
ïï 
_logger
ññ 
.
ññ 
LogError
ññ $
(
ññ$ %
$str
ññ% Q
)
ññQ R
;
ññR S
return
óó 

BadRequest
óó %
(
óó% &
$str
óó& <
)
óó< =
;
óó= >
}
òò 
var
öö 
dbTimetable
öö 
=
öö  !
_repository
öö" -
.
öö- .
	Timetable
öö. 7
.
öö7 8
GetTimetableById
öö8 H
(
ööH I
id
ööI K
)
ööK L
;
ööL M
if
õõ 
(
õõ 
dbTimetable
õõ 
.
õõ  
IsEmptyObject
õõ  -
(
õõ- .
id
õõ. 0
)
õõ0 1
)
õõ1 2
{
úú 
_logger
ùù 
.
ùù 
LogError
ùù $
(
ùù$ %
$"
ùù% '!
Timetable with id: 
ùù' :
{
ùù: ;
id
ùù; =
}
ùù= >(
, hasn't been found in db.
ùù> X
"
ùùX Y
)
ùùY Z
;
ùùZ [
return
ûû 
NotFound
ûû #
(
ûû# $
)
ûû$ %
;
ûû% &
}
üü 
	timetable
†† 
.
†† 
Id
†† 
=
†† 
id
†† !
;
††! "
_repository
°° 
.
°° 
	Timetable
°° %
.
°°% &
UpdateTimetable
°°& 5
(
°°5 6
dbTimetable
°°6 A
,
°°A B
	timetable
°°C L
)
°°L M
;
°°M N
_repository
¢¢ 
.
¢¢ 
Save
¢¢  
(
¢¢  !
)
¢¢! "
;
¢¢" #
return
§§ 
	NoContent
§§  
(
§§  !
)
§§! "
;
§§" #
}
•• 
catch
¶¶ 
(
¶¶ 
	Exception
¶¶ 
ex
¶¶ 
)
¶¶  
{
ßß 
_logger
®® 
.
®® 
LogError
®®  
(
®®  !
$"
®®! #B
4Something went wrong inside UpdateTimetable action: 
®®# W
{
®®W X
ex
®®X Z
.
®®Z [
Message
®®[ b
}
®®b c
"
®®c d
)
®®d e
;
®®e f
return
©© 

StatusCode
©© !
(
©©! "
$num
©©" %
,
©©% &
$str
©©' >
)
©©> ?
;
©©? @
}
™™ 
}
´´ 	
[
≠≠ 	
	Authorize
≠≠	 
(
≠≠ 
Roles
≠≠ 
=
≠≠ 
Role
≠≠ 
.
≠≠  
Master
≠≠  &
)
≠≠& '
]
≠≠' (
[
ÆÆ 	

HttpDelete
ÆÆ	 
(
ÆÆ 
$str
ÆÆ 
)
ÆÆ 
]
ÆÆ 
public
ØØ 
IActionResult
ØØ 
DeleteTimetable
ØØ ,
(
ØØ, -
int
ØØ- 0
id
ØØ1 3
)
ØØ3 4
{
∞∞ 	
try
±± 
{
≤≤ 
var
≥≥ 
	timetable
≥≥ 
=
≥≥ 
_repository
≥≥  +
.
≥≥+ ,
	Timetable
≥≥, 5
.
≥≥5 6
GetTimetableById
≥≥6 F
(
≥≥F G
id
≥≥G I
)
≥≥I J
;
≥≥J K
if
¥¥ 
(
¥¥ 
	timetable
¥¥ 
.
¥¥ 
IsEmptyObject
¥¥ +
(
¥¥+ ,
id
¥¥, .
)
¥¥. /
)
¥¥/ 0
{
µµ 
_logger
∂∂ 
.
∂∂ 
LogError
∂∂ $
(
∂∂$ %
$"
∂∂% '!
Timetable with id: 
∂∂' :
{
∂∂: ;
id
∂∂; =
}
∂∂= >(
, hasn't been found in db.
∂∂> X
"
∂∂X Y
)
∂∂Y Z
;
∂∂Z [
return
∑∑ 
NotFound
∑∑ #
(
∑∑# $
)
∑∑$ %
;
∑∑% &
}
∏∏ 
if
∫∫ 
(
∫∫ 
_authService
∫∫  
.
∫∫  !
IsMaster
∫∫! )
(
∫∫) *
Request
∫∫* 1
.
∫∫1 2
Headers
∫∫2 9
[
∫∫9 :
$str
∫∫: I
]
∫∫I J
)
∫∫J K
&&
∫∫L N
_authService
∫∫O [
.
∫∫[ \
GetId
∫∫\ a
(
∫∫a b
Request
∫∫b i
.
∫∫i j
Headers
∫∫j q
[
∫∫q r
$str∫∫r Å
]∫∫Å Ç
)∫∫Ç É
!=∫∫Ñ Ü
	timetable∫∫á ê
.∫∫ê ë
MasterId∫∫ë ô
)∫∫ô ö
{
ªª 
_logger
ºº 
.
ºº 
LogError
ºº $
(
ºº$ %
$"
ºº% '
User with id: 
ºº' 5
{
ºº5 6
id
ºº6 8
}
ºº8 9G
9, has tried to access restricted data in DeleteTimetable.
ºº9 r
"
ººr s
)
ººs t
;
ººt u
return
ΩΩ 
Unauthorized
ΩΩ '
(
ΩΩ' (
)
ΩΩ( )
;
ΩΩ) *
}
ææ 
if
¿¿ 
(
¿¿ 
_repository
¿¿ 
.
¿¿  
Reservation
¿¿  +
.
¿¿+ ,%
ReservationsByTimetable
¿¿, C
(
¿¿C D
	timetable
¿¿D M
.
¿¿M N
Date
¿¿N R
,
¿¿R S
	timetable
¿¿T ]
.
¿¿] ^
	TimeStart
¿¿^ g
,
¿¿g h
	timetable
¿¿i r
.
¿¿r s
TimeEnd
¿¿s z
)
¿¿z {
.
¿¿{ |
Any
¿¿| 
(¿¿ Ä
)¿¿Ä Å
)¿¿Å Ç
{
¡¡ 
_logger
¬¬ 
.
¬¬ 
LogError
¬¬ $
(
¬¬$ %
$"
¬¬% '/
!Cannot delete timetable with id: 
¬¬' H
{
¬¬H I
id
¬¬I K
}
¬¬K LM
>. It has related reservations. Delete those resrevations first¬¬L ä
"¬¬ä ã
)¬¬ã å
;¬¬å ç
return
√√ 

BadRequest
√√ %
(
√√% &
$str
√√& }
)
√√} ~
;
√√~ 
}
ƒƒ 
_repository
∆∆ 
.
∆∆ 
	Timetable
∆∆ %
.
∆∆% &
DeleteTimetable
∆∆& 5
(
∆∆5 6
	timetable
∆∆6 ?
)
∆∆? @
;
∆∆@ A
_repository
«« 
.
«« 
Save
««  
(
««  !
)
««! "
;
««" #
return
…… 
	NoContent
……  
(
……  !
)
……! "
;
……" #
}
   
catch
ÀÀ 
(
ÀÀ 
	Exception
ÀÀ 
ex
ÀÀ 
)
ÀÀ  
{
ÃÃ 
_logger
ÕÕ 
.
ÕÕ 
LogError
ÕÕ  
(
ÕÕ  !
$"
ÕÕ! #B
4Something went wrong inside DeleteTimetable action: 
ÕÕ# W
{
ÕÕW X
ex
ÕÕX Z
.
ÕÕZ [
Message
ÕÕ[ b
}
ÕÕb c
"
ÕÕc d
)
ÕÕd e
;
ÕÕe f
return
ŒŒ 

StatusCode
ŒŒ !
(
ŒŒ! "
$num
ŒŒ" %
,
ŒŒ% &
$str
ŒŒ' >
)
ŒŒ> ?
;
ŒŒ? @
}
œœ 
}
–– 	
}
—— 
}““ —®
RC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\UserController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{ 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UserController 
:  !

Controller" ,
{ 
private 
readonly 
IAuthService %
_authService& 2
;2 3
private 
ILoggerManager 
_logger &
;& '
public 
IRepositoryWrapper !
_repository" -
;- .
private 
readonly 
string 
_secret  '
;' (
public 
UserController 
( 
IOptions &
<& '
AppSettings' 2
>2 3
appSettings4 ?
,? @
ILoggerManagerA O
loggerP V
,V W
IRepositoryWrapperX j

repositoryk u
,u v
IAuthService	w É
authService
Ñ è
)
è ê
{ 	
_logger 
= 
logger 
; 
_repository 
= 

repository $
;$ %
_secret 
= 
appSettings !
.! "
Value" '
.' (
Secret( .
;. /
_authService 
= 
authService &
;& '
} 	
[!! 	
	Authorize!!	 
(!! 
Roles!! 
=!! 
Role!! 
.!!  
Admin!!  %
)!!% &
]!!& '
["" 	
HttpGet""	 
]"" 
public## 
IActionResult## 
GetAllUsers## (
(##( )
)##) *
{$$ 	
try%% 
{&& 
var'' 
users'' 
='' 
_repository'' '
.''' (
User''( ,
.'', -
GetAllUsers''- 8
(''8 9
)''9 :
;'': ;
_logger)) 
.)) 
LogInfo)) 
())  
$"))  "-
!Returned all users from database.))" C
"))C D
)))D E
;))E F
return++ 
Ok++ 
(++ 
users++ 
)++  
;++  !
},, 
catch-- 
(-- 
	Exception-- 
ex-- 
)--  
{.. 
_logger// 
.// 
LogError//  
(//  !
$"//! #<
0Something went wrong inside GetAllUsers action: //# S
{//S T
ex//T V
.//V W
Message//W ^
}//^ _
"//_ `
)//` a
;//a b
return00 
NotFound00 
(00  
)00  !
;00! "
}11 
}22 	
[44 	
AllowAnonymous44	 
]44 
[55 	
HttpGet55	 
(55 
$str55 
)55 
]55 
public66 
IActionResult66 
GetAllMasters66 *
(66* +
)66+ ,
{77 	
try88 
{99 
var:: 
users:: 
=:: 
_repository:: '
.::' (
User::( ,
.::, -
GetAllMasters::- :
(::: ;
)::; <
;::< =
foreach;; 
(;; 
User;; 
user;; !
in;;" $
users;;% *
);;* +
{<< 
user== 
.== 
Password== !
===" #
null==$ (
;==( )
}>> 
_logger@@ 
.@@ 
LogInfo@@ 
(@@  
$"@@  "/
#Returned all masters from database.@@" E
"@@E F
)@@F G
;@@G H
returnBB 
OkBB 
(BB 
usersBB 
)BB  
;BB  !
}CC 
catchDD 
(DD 
	ExceptionDD 
exDD 
)DD  
{EE 
_loggerFF 
.FF 
LogErrorFF  
(FF  !
$"FF! #>
2Something went wrong inside GetAllMasters action: FF# U
{FFU V
exFFV X
.FFX Y
MessageFFY `
}FF` a
"FFa b
)FFb c
;FFc d
returnGG 
NotFoundGG 
(GG  
)GG  !
;GG! "
}HH 
}II 	
[KK 	
	AuthorizeKK	 
(KK 
RolesKK 
=KK 
RoleKK 
.KK  
ClientMasterAdminKK  1
)KK1 2
]KK2 3
[LL 	
HttpGetLL	 
(LL 
$strLL 
)LL 
]LL 
publicMM 
IActionResultMM 
GetUserByIdMM (
(MM( )
intMM) ,
idMM- /
)MM/ 0
{NN 	
tryOO 
{PP 
ifQQ 
(QQ 
!QQ 
_authServiceQQ !
.QQ! "
IsAdminQQ" )
(QQ) *
RequestQQ* 1
.QQ1 2
HeadersQQ2 9
[QQ9 :
$strQQ: I
]QQI J
)QQJ K
&&QQL N
_authServiceQQO [
.QQ[ \
GetIdQQ\ a
(QQa b
RequestQQb i
.QQi j
HeadersQQj q
[QQq r
$str	QQr Å
]
QQÅ Ç
)
QQÇ É
!=
QQÑ Ü
id
QQá â
)
QQâ ä
{RR 
_loggerSS 
.SS 
LogErrorSS $
(SS$ %
$"SS% '
User with id: SS' 5
{SS5 6
idSS6 8
}SS8 9A
5, has tried to access restricted data in GetUserById.SS9 n
"SSn o
)SSo p
;SSp q
returnTT 
UnauthorizedTT '
(TT' (
)TT( )
;TT) *
}UU 
varWW 
userWW 
=WW 
_repositoryWW &
.WW& '
UserWW' +
.WW+ ,
GetUserByIdWW, 7
(WW7 8
idWW8 :
)WW: ;
;WW; <
ifYY 
(YY 
userYY 
.YY 
IsEmptyObjectYY &
(YY& '
idYY' )
)YY) *
)YY* +
{ZZ 
_logger[[ 
.[[ 
LogError[[ $
([[$ %
$"[[% '
User with id: [[' 5
{[[5 6
id[[6 8
}[[8 9&
, hasn't been found in db.[[9 S
"[[S T
)[[T U
;[[U V
return\\ 
NotFound\\ #
(\\# $
)\\$ %
;\\% &
}]] 
else^^ 
{__ 
_logger`` 
.`` 
LogInfo`` #
(``# $
$"``$ &#
Returned user with id: ``& =
{``= >
id``> @
}``@ A
"``A B
)``B C
;``C D
returnaa 
Okaa 
(aa 
useraa "
)aa" #
;aa# $
}bb 
}cc 
catchdd 
(dd 
	Exceptiondd 
exdd 
)dd  
{ee 
_loggerff 
.ff 
LogErrorff  
(ff  !
$"ff! #<
0Something went wrong inside GetUserById action: ff# S
{ffS T
exffT V
.ffV W
MessageffW ^
}ff^ _
"ff_ `
)ff` a
;ffa b
returngg 

StatusCodegg !
(gg! "
$numgg" %
,gg% &
$strgg' >
)gg> ?
;gg? @
}hh 
}ii 	
[kk 	
	Authorizekk	 
(kk 
Roleskk 
=kk 
Rolekk 
.kk  
ClientMasterAdminkk  1
)kk1 2
]kk2 3
[ll 	
HttpGetll	 
(ll 
$strll $
)ll$ %
]ll% &
publicmm 
IActionResultmm 
GetUserWithDetailsmm /
(mm/ 0
intmm0 3
idmm4 6
)mm6 7
{nn 	
tryoo 
{pp 
ifqq 
(qq 
!qq 
_authServiceqq !
.qq! "
IsAdminqq" )
(qq) *
Requestqq* 1
.qq1 2
Headersqq2 9
[qq9 :
$strqq: I
]qqI J
)qqJ K
&&qqL N
_authServiceqqO [
.qq[ \
GetIdqq\ a
(qqa b
Requestqqb i
.qqi j
Headersqqj q
[qqq r
$str	qqr Å
]
qqÅ Ç
)
qqÇ É
!=
qqÑ Ü
id
qqá â
)
qqâ ä
{rr 
_loggerss 
.ss 
LogErrorss $
(ss$ %
$"ss% '
User with id: ss' 5
{ss5 6
idss6 8
}ss8 9A
5, has tried to access restricted data in GetUserById.ss9 n
"ssn o
)sso p
;ssp q
returntt 
Unauthorizedtt '
(tt' (
)tt( )
;tt) *
}uu 
varww 
userww 
=ww 
_repositoryww &
.ww& '
Userww' +
.ww+ ,
GetUserWithDetailsww, >
(ww> ?
idww? A
)wwA B
;wwB C
ifyy 
(yy 
useryy 
.yy 
IsEmptyObjectyy %
(yy% &
idyy& (
)yy( )
)yy) *
{zz 
_logger{{ 
.{{ 
LogError{{ $
({{$ %
$"{{% '
User with id: {{' 5
{{{5 6
id{{6 8
}{{8 9&
, hasn't been found in db.{{9 S
"{{S T
){{T U
;{{U V
return|| 
NotFound|| #
(||# $
)||$ %
;||% &
}}} 
else~~ 
{ 
_logger
ÄÄ 
.
ÄÄ 
LogInfo
ÄÄ #
(
ÄÄ# $
$"
ÄÄ$ &1
#Returned user with details for id: 
ÄÄ& I
{
ÄÄI J
id
ÄÄJ L
}
ÄÄL M
"
ÄÄM N
)
ÄÄN O
;
ÄÄO P
return
ÅÅ 
Ok
ÅÅ 
(
ÅÅ 
user
ÅÅ "
)
ÅÅ" #
;
ÅÅ# $
}
ÇÇ 
}
ÉÉ 
catch
ÑÑ 
(
ÑÑ 
	Exception
ÑÑ 
ex
ÑÑ 
)
ÑÑ  
{
ÖÖ 
_logger
ÜÜ 
.
ÜÜ 
LogError
ÜÜ  
(
ÜÜ  !
$"
ÜÜ! #E
7Something went wrong inside GetUserWithDetails action: 
ÜÜ# Z
{
ÜÜZ [
ex
ÜÜ[ ]
.
ÜÜ] ^
Message
ÜÜ^ e
}
ÜÜe f
"
ÜÜf g
)
ÜÜg h
;
ÜÜh i
return
áá 

StatusCode
áá !
(
áá! "
$num
áá" %
,
áá% &
$str
áá' >
)
áá> ?
;
áá? @
}
àà 
}
ââ 	
[
ãã 	
AllowAnonymous
ãã	 
]
ãã 
[
åå 	
HttpPost
åå	 
]
åå 
public
çç 
IActionResult
çç 

CreateUser
çç '
(
çç' (
[
çç( )
FromBody
çç) 1
]
çç1 2
User
çç2 6
user
çç7 ;
)
çç; <
{
éé 	
try
èè 
{
êê 
if
íí 
(
íí 
user
íí 
.
íí 
IsObjectNull
íí %
(
íí% &
)
íí& '
)
íí' (
{
ìì 
_logger
îî 
.
îî 
LogError
îî $
(
îî$ %
$str
îî% L
)
îîL M
;
îîM N
return
ïï 

BadRequest
ïï %
(
ïï% &
$str
ïï& ;
)
ïï; <
;
ïï< =
}
ññ 
if
òò 
(
òò 
!
òò 

ModelState
òò 
.
òò  
IsValid
òò  '
)
òò' (
{
ôô 
_logger
öö 
.
öö 
LogError
öö $
(
öö$ %
$str
öö% L
)
ööL M
;
ööM N
return
õõ 

BadRequest
õõ %
(
õõ% &
$str
õõ& <
)
õõ< =
;
õõ= >
}
úú 
_repository
ûû 
.
ûû 
User
ûû  
.
ûû  !

CreateUser
ûû! +
(
ûû+ ,
user
ûû, 0
)
ûû0 1
;
ûû1 2
_repository
üü 
.
üü 
Save
üü  
(
üü  !
)
üü! "
;
üü" #
return
°° 
Ok
°° 
(
°° 
user
°° 
)
°° 
;
°°  
}
§§ 
catch
•• 
(
•• 
	Exception
•• 
ex
•• 
)
••  
{
¶¶ 
_logger
ßß 
.
ßß 
LogError
ßß  
(
ßß  !
$"
ßß! #=
/Something went wrong inside CreateUser action: 
ßß# R
{
ßßR S
ex
ßßS U
.
ßßU V
Message
ßßV ]
}
ßß] ^
"
ßß^ _
)
ßß_ `
;
ßß` a
return
®® 

StatusCode
®® !
(
®®! "
$num
®®" %
,
®®% &
$str
®®' >
)
®®> ?
;
®®? @
}
©© 
}
™™ 	
[
¨¨ 	
	Authorize
¨¨	 
(
¨¨ 
Roles
¨¨ 
=
¨¨ 
Role
¨¨ 
.
¨¨  
ClientMasterAdmin
¨¨  1
)
¨¨1 2
]
¨¨2 3
[
≠≠ 	
HttpPut
≠≠	 
(
≠≠ 
$str
≠≠ 
)
≠≠ 
]
≠≠ 
public
ÆÆ 
IActionResult
ÆÆ 

UpdateUser
ÆÆ '
(
ÆÆ' (
int
ÆÆ( +
id
ÆÆ, .
,
ÆÆ. /
[
ÆÆ0 1
FromBody
ÆÆ1 9
]
ÆÆ9 :
User
ÆÆ: >
user
ÆÆ? C
)
ÆÆC D
{
ØØ 	
try
∞∞ 
{
±± 
if
≤≤ 
(
≤≤ 
!
≤≤ 
_authService
≤≤ !
.
≤≤! "
IsAdmin
≤≤" )
(
≤≤) *
Request
≤≤* 1
.
≤≤1 2
Headers
≤≤2 9
[
≤≤9 :
$str
≤≤: I
]
≤≤I J
)
≤≤J K
&&
≤≤L N
_authService
≤≤O [
.
≤≤[ \
GetId
≤≤\ a
(
≤≤a b
Request
≤≤b i
.
≤≤i j
Headers
≤≤j q
[
≤≤q r
$str≤≤r Å
]≤≤Å Ç
)≤≤Ç É
!=≤≤Ñ Ü
id≤≤á â
)≤≤â ä
{
≥≥ 
_logger
¥¥ 
.
¥¥ 
LogError
¥¥ $
(
¥¥$ %
$"
¥¥% '
User with id: 
¥¥' 5
{
¥¥5 6
id
¥¥6 8
}
¥¥8 9C
5, has tried to access restricted data in GetUserById.
¥¥9 n
"
¥¥n o
)
¥¥o p
;
¥¥p q
return
µµ 
Unauthorized
µµ '
(
µµ' (
)
µµ( )
;
µµ) *
}
∂∂ 
if
∏∏ 
(
∏∏ 
user
∏∏ 
.
∏∏ 
IsObjectNull
∏∏ %
(
∏∏% &
)
∏∏& '
)
∏∏' (
{
ππ 
_logger
∫∫ 
.
∫∫ 
LogError
∫∫ $
(
∫∫$ %
$str
∫∫% L
)
∫∫L M
;
∫∫M N
return
ªª 

BadRequest
ªª %
(
ªª% &
$str
ªª& ;
)
ªª; <
;
ªª< =
}
ºº 
if
ææ 
(
ææ 
!
ææ 

ModelState
ææ 
.
ææ  
IsValid
ææ  '
)
ææ' (
{
øø 
_logger
¿¿ 
.
¿¿ 
LogError
¿¿ $
(
¿¿$ %
$str
¿¿% L
)
¿¿L M
;
¿¿M N
return
¡¡ 

BadRequest
¡¡ %
(
¡¡% &
$str
¡¡& <
)
¡¡< =
;
¡¡= >
}
¬¬ 
var
ƒƒ 
dbUser
ƒƒ 
=
ƒƒ 
_repository
ƒƒ (
.
ƒƒ( )
User
ƒƒ) -
.
ƒƒ- .
GetUserById
ƒƒ. 9
(
ƒƒ9 :
id
ƒƒ: <
)
ƒƒ< =
;
ƒƒ= >
if
≈≈ 
(
≈≈ 
dbUser
≈≈ 
.
≈≈ 
IsEmptyObject
≈≈ (
(
≈≈( )
id
≈≈) +
)
≈≈+ ,
)
≈≈, -
{
∆∆ 
_logger
«« 
.
«« 
LogError
«« $
(
««$ %
$"
««% '
User with id: 
««' 5
{
««5 6
id
««6 8
}
««8 9(
, hasn't been found in db.
««9 S
"
««S T
)
««T U
;
««U V
return
»» 
NotFound
»» #
(
»»# $
)
»»$ %
;
»»% &
}
…… 
user
   
.
   
Id
   
=
   
id
   
;
   
_repository
ÀÀ 
.
ÀÀ 
User
ÀÀ  
.
ÀÀ  !

UpdateUser
ÀÀ! +
(
ÀÀ+ ,
dbUser
ÀÀ, 2
,
ÀÀ2 3
user
ÀÀ4 8
)
ÀÀ8 9
;
ÀÀ9 :
_repository
ÃÃ 
.
ÃÃ 
Save
ÃÃ  
(
ÃÃ  !
)
ÃÃ! "
;
ÃÃ" #
return
ŒŒ 
	NoContent
ŒŒ  
(
ŒŒ  !
)
ŒŒ! "
;
ŒŒ" #
}
œœ 
catch
–– 
(
–– 
	Exception
–– 
ex
–– 
)
––  
{
—— 
_logger
““ 
.
““ 
LogError
““  
(
““  !
$"
““! #=
/Something went wrong inside UpdateUser action: 
““# R
{
““R S
ex
““S U
.
““U V
Message
““V ]
}
““] ^
"
““^ _
)
““_ `
;
““` a
return
”” 

StatusCode
”” !
(
””! "
$num
””" %
,
””% &
$str
””' >
)
””> ?
;
””? @
}
‘‘ 
}
’’ 	
[
◊◊ 	
	Authorize
◊◊	 
(
◊◊ 
Roles
◊◊ 
=
◊◊ 
Role
◊◊ 
.
◊◊  
ClientMasterAdmin
◊◊  1
)
◊◊1 2
]
◊◊2 3
[
ÿÿ 	

HttpDelete
ÿÿ	 
(
ÿÿ 
$str
ÿÿ 
)
ÿÿ 
]
ÿÿ 
public
ŸŸ 
IActionResult
ŸŸ 

DeleteUser
ŸŸ '
(
ŸŸ' (
int
ŸŸ( +
id
ŸŸ, .
)
ŸŸ. /
{
⁄⁄ 	
try
€€ 
{
‹‹ 
if
›› 
(
›› 
!
›› 
_authService
›› !
.
››! "
IsAdmin
››" )
(
››) *
Request
››* 1
.
››1 2
Headers
››2 9
[
››9 :
$str
››: I
]
››I J
)
››J K
&&
››L N
_authService
››O [
.
››[ \
GetId
››\ a
(
››a b
Request
››b i
.
››i j
Headers
››j q
[
››q r
$str››r Å
]››Å Ç
)››Ç É
!=››Ñ Ü
id››á â
)››â ä
{
ﬁﬁ 
_logger
ﬂﬂ 
.
ﬂﬂ 
LogError
ﬂﬂ $
(
ﬂﬂ$ %
$"
ﬂﬂ% '
User with id: 
ﬂﬂ' 5
{
ﬂﬂ5 6
id
ﬂﬂ6 8
}
ﬂﬂ8 9C
5, has tried to access restricted data in GetUserById.
ﬂﬂ9 n
"
ﬂﬂn o
)
ﬂﬂo p
;
ﬂﬂp q
return
‡‡ 
Unauthorized
‡‡ '
(
‡‡' (
)
‡‡( )
;
‡‡) *
}
·· 
var
„„ 
user
„„ 
=
„„ 
_repository
„„ &
.
„„& '
User
„„' +
.
„„+ ,
GetUserById
„„, 7
(
„„7 8
id
„„8 :
)
„„: ;
;
„„; <
if
‰‰ 
(
‰‰ 
user
‰‰ 
.
‰‰ 
IsEmptyObject
‰‰ &
(
‰‰& '
id
‰‰' )
)
‰‰) *
)
‰‰* +
{
ÂÂ 
_logger
ÊÊ 
.
ÊÊ 
LogError
ÊÊ $
(
ÊÊ$ %
$"
ÊÊ% '
User with id: 
ÊÊ' 5
{
ÊÊ5 6
id
ÊÊ6 8
}
ÊÊ8 9(
, hasn't been found in db.
ÊÊ9 S
"
ÊÊS T
)
ÊÊT U
;
ÊÊU V
return
ÁÁ 
NotFound
ÁÁ #
(
ÁÁ# $
)
ÁÁ$ %
;
ÁÁ% &
}
ËË 
if
ÍÍ 
(
ÍÍ 
_repository
ÍÍ 
.
ÍÍ  
Reservation
ÍÍ  +
.
ÍÍ+ ,#
GetReservationsByUser
ÍÍ, A
(
ÍÍA B
id
ÍÍB D
)
ÍÍD E
.
ÍÍE F
Any
ÍÍF I
(
ÍÍI J
)
ÍÍJ K
)
ÍÍK L
{
ÎÎ 
_logger
ÏÏ 
.
ÏÏ 
LogError
ÏÏ $
(
ÏÏ$ %
$"
ÏÏ% '*
Cannot delete user with id: 
ÏÏ' C
{
ÏÏC D
id
ÏÏD F
}
ÏÏF GM
>. It has related reservations. Delete those reservations firstÏÏG Ö
"ÏÏÖ Ü
)ÏÏÜ á
;ÏÏá à
return
ÌÌ 

BadRequest
ÌÌ %
(
ÌÌ% &
$str
ÌÌ& x
)
ÌÌx y
;
ÌÌy z
}
ÓÓ 
_repository
 
.
 
User
  
.
  !

DeleteUser
! +
(
+ ,
user
, 0
)
0 1
;
1 2
_repository
ÒÒ 
.
ÒÒ 
Save
ÒÒ  
(
ÒÒ  !
)
ÒÒ! "
;
ÒÒ" #
return
ÛÛ 
	NoContent
ÛÛ  
(
ÛÛ  !
)
ÛÛ! "
;
ÛÛ" #
}
ÙÙ 
catch
ıı 
(
ıı 
	Exception
ıı 
ex
ıı 
)
ıı  
{
ˆˆ 
_logger
˜˜ 
.
˜˜ 
LogError
˜˜  
(
˜˜  !
$"
˜˜! #=
/Something went wrong inside DeleteUser action: 
˜˜# R
{
˜˜R S
ex
˜˜S U
.
˜˜U V
Message
˜˜V ]
}
˜˜] ^
"
˜˜^ _
)
˜˜_ `
;
˜˜` a
return
¯¯ 

StatusCode
¯¯ !
(
¯¯! "
$num
¯¯" %
,
¯¯% &
$str
¯¯' >
)
¯¯> ?
;
¯¯? @
}
˘˘ 
}
˙˙ 	
}
˚˚ 
}¸¸ —
TC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Controllers\ValuesController.cs
	namespace 	
BeautySalon
 
. 
Controllers !
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
public 

class 
ValuesController !
:" #
ControllerBase$ 2
{ 
private 
IRepositoryWrapper "
_repoWrapper# /
;/ 0
public 
ValuesController 
(  
IRepositoryWrapper  2
repoWrapper3 >
)> ?
{ 	
_repoWrapper 
= 
repoWrapper &
;& '
} 	
[ 	
HttpGet	 
] 
public 
IEnumerable 
< 
string !
>! "
Get# &
(& '
)' (
{ 	
var 
users 
= 
_repoWrapper $
.$ %
User% )
.) *
FindByCondition* 9
(9 :
x: ;
=>< >
x? @
.@ A
IdA C
.C D
EqualsD J
(J K
$strK N
)N O
)O P
;P Q
var 

timetables 
= 
_repoWrapper )
.) *
	Timetable* 3
.3 4
FindAll4 ;
(; <
)< =
;= >
return 
new 
string 
[ 
] 
{  !
$str" %
,% &
$str' /
}0 1
;1 2
} 	
[&& 	
HttpGet&&	 
(&& 
$str&& 
)&& 
]&& 
public'' 
ActionResult'' 
<'' 
string'' "
>''" #
Get''$ '
(''' (
int''( +
id'', .
)''. /
{(( 	
return)) 
$str)) 
;)) 
}** 	
[-- 	
HttpPost--	 
]-- 
public.. 
void.. 
Post.. 
(.. 
[.. 
FromBody.. "
].." #
string..$ *
value..+ 0
)..0 1
{// 	
}00 	
[33 	
HttpPut33	 
(33 
$str33 
)33 
]33 
public44 
void44 
Put44 
(44 
int44 
id44 
,44 
[44  !
FromBody44! )
]44) *
string44+ 1
value442 7
)447 8
{55 	
}66 	
[99 	

HttpDelete99	 
(99 
$str99 
)99 
]99 
public:: 
void:: 
Delete:: 
(:: 
int:: 
id:: !
)::! "
{;; 	
}<< 	
}== 
}>> ƒ
TC:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Extensions\ServiceExtensions.cs
	namespace 	
BeautySalon
 
. 

Extensions  
{ 
public 

static 
class 
ServiceExtensions )
{ 
public 
static 
void 
ConfigureCors (
(( )
this) -
IServiceCollection. @
servicesA I
)I J
{ 	
services 
. 
AddCors 
( 
options $
=>% '
{ 
options 
. 
	AddPolicy !
(! "
$str" .
,. /
builder 
=> 
builder &
.& '
AllowAnyOrigin' 5
(5 6
)6 7
. 
AllowAnyMethod #
(# $
)$ %
. 
AllowAnyHeader #
(# $
)$ %
. 
AllowCredentials %
(% &
)& '
)' (
;( )
} 
) 
; 
} 	
public 
static 
void #
ConfigureIISIntegration 2
(2 3
this3 7
IServiceCollection8 J
servicesK S
)S T
{ 	
services   
.   
	Configure   
<   

IISOptions   )
>  ) *
(  * +
options  + 2
=>  3 5
{!! 
}## 
)## 
;## 
}$$ 	
public&& 
static&& 
void&& "
ConfigureLoggerService&& 1
(&&1 2
this&&2 6
IServiceCollection&&7 I
services&&J R
)&&R S
{'' 	
services(( 
.(( 
AddSingleton(( !
<((! "
ILoggerManager((" 0
,((0 1
LoggerManager((2 ?
>((? @
(((@ A
)((A B
;((B C
})) 	
public++ 
static++ 
void++ !
ConfigureMySqlContext++ 0
(++0 1
this++1 5
IServiceCollection++6 H
services++I Q
,++Q R
IConfiguration++S a
config++b h
)++h i
{,, 	
var-- 
connectionString--  
=--! "
config--# )
[--) *
$str--* L
]--L M
;--M N
services.. 
... 
AddDbContext.. !
<..! "
RepositoryContext.." 3
>..3 4
(..4 5
o..5 6
=>..7 9
o..: ;
...; <
UseMySql..< D
(..D E
connectionString..E U
)..U V
)..V W
;..W X
}// 	
public22 
static22 
void22 &
ConfigureRepositoryWrapper22 5
(225 6
this226 :
IServiceCollection22; M
services22N V
)22V W
{33 	
services44 
.44 
	AddScoped44 
<44 
IRepositoryWrapper44 1
,441 2
RepositoryWrapper443 D
>44D E
(44E F
)44F G
;44G H
}55 	
}66 
}77 ‰
?C:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Program.cs
	namespace 	
BeautySalon
 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	 
CreateWebHostBuilder  
(  !
args! %
)% &
.& '
Build' ,
(, -
)- .
.. /
Run/ 2
(2 3
)3 4
;4 5
} 	
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
=>J L
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
;& '
} 
} Æ:
?C:\Users\Kamile\source\repos\BeautySalon\BeautySalon\Startup.cs
	namespace 	
BeautySalon
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	

LogManager 
. 
LoadConfiguration (
(( )
String) /
./ 0
Concat0 6
(6 7
	Directory7 @
.@ A
GetCurrentDirectoryA T
(T U
)U V
,V W
$strX f
)f g
)g h
;h i
Configuration!! 
=!! 
configuration!! )
;!!) *
}"" 	
public$$ 
IConfiguration$$ 
Configuration$$ +
{$$, -
get$$. 1
;$$1 2
}$$3 4
public'' 
void'' 
ConfigureServices'' %
(''% &
IServiceCollection''& 8
services''9 A
)''A B
{(( 	
services)) 
.)) 
ConfigureCors)) "
())" #
)))# $
;))$ %
services++ 
.++ #
ConfigureIISIntegration++ ,
(++, -
)++- .
;++. /
services-- 
.-- "
ConfigureLoggerService-- +
(--+ ,
)--, -
;--- .
services// 
.// !
ConfigureMySqlContext// *
(//* +
Configuration//+ 8
)//8 9
;//9 :
services11 
.11 &
ConfigureRepositoryWrapper11 /
(11/ 0
)110 1
;111 2
var33 
appSettingsSection33 "
=33# $
Configuration33% 2
.332 3

GetSection333 =
(33= >
$str33> K
)33K L
;33L M
services44 
.44 
	Configure44 
<44 
AppSettings44 *
>44* +
(44+ ,
appSettingsSection44, >
)44> ?
;44? @
var66 
appSettings66 
=66 
appSettingsSection66 0
.660 1
Get661 4
<664 5
AppSettings665 @
>66@ A
(66A B
)66B C
;66C D
var77 
key77 
=77 
Encoding77 
.77 
ASCII77 $
.77$ %
GetBytes77% -
(77- .
appSettings77. 9
.779 :
Secret77: @
)77@ A
;77A B
services88 
.88 
AddAuthentication88 &
(88& '
x88' (
=>88) +
{99 
x:: 
.:: %
DefaultAuthenticateScheme:: +
=::, -
JwtBearerDefaults::. ?
.::? @ 
AuthenticationScheme::@ T
;::T U
x;; 
.;; "
DefaultChallengeScheme;; (
=;;) *
JwtBearerDefaults;;+ <
.;;< = 
AuthenticationScheme;;= Q
;;;Q R
}<< 
)<< 
.== 
AddJwtBearer== 
(== 
x== 
=>== 
{>> 
x?? 
.??  
RequireHttpsMetadata?? &
=??' (
false??) .
;??. /
x@@ 
.@@ 
	SaveToken@@ 
=@@ 
true@@ "
;@@" #
xAA 
.AA %
TokenValidationParametersAA +
=AA, -
newAA. 1%
TokenValidationParametersAA2 K
{BB $
ValidateIssuerSigningKeyCC ,
=CC- .
trueCC/ 3
,CC3 4
IssuerSigningKeyDD $
=DD% &
newDD' * 
SymmetricSecurityKeyDD+ ?
(DD? @
keyDD@ C
)DDC D
,DDD E
ValidateIssuerEE "
=EE# $
falseEE% *
,EE* +
ValidateAudienceFF $
=FF% &
falseFF' ,
}GG 
;GG 
}HH 
)HH 
;HH 
servicesJJ 
.JJ 
	AddScopedJJ 
<JJ 
IAuthServiceJJ +
,JJ+ ,
AuthServiceJJ- 8
>JJ8 9
(JJ9 :
)JJ: ;
;JJ; <
servicesKK 
.KK 
	AddScopedKK 
<KK 
IUserRepositoryKK .
,KK. /
UserRepositoryKK0 >
>KK> ?
(KK? @
)KK@ A
;KKA B
services]] 
.]] 
AddMvc]] 
(]] 
)]] 
.]] #
SetCompatibilityVersion]] 5
(]]5 6 
CompatibilityVersion]]6 J
.]]J K
Version_2_1]]K V
)]]V W
;]]W X
}^^ 	
publicaa 
voidaa 
	Configureaa 
(aa 
IApplicationBuilderaa 1
appaa2 5
,aa5 6
IHostingEnvironmentaa7 J
envaaK N
)aaN O
{bb 	
ifcc 
(cc 
envcc 
.cc 
IsDevelopmentcc !
(cc! "
)cc" #
)cc# $
{dd 
appee 
.ee %
UseDeveloperExceptionPageee -
(ee- .
)ee. /
;ee/ 0
}ff 
elsegg 
{hh 
appii 
.ii 
Useii 
(ii 
asyncii 
(ii 
contextii &
,ii& '
nextii( ,
)ii, -
=>ii. 0
{jj 
awaitkk 
nextkk 
(kk 
)kk  
;kk  !
ifll 
(ll 
contextll 
.ll  
Responsell  (
.ll( )

StatusCodell) 3
==ll4 6
$numll7 :
&&ll; =
!ll> ?
Pathll? C
.llC D
HasExtensionllD P
(llP Q
contextllQ X
.llX Y
RequestllY `
.ll` a
Pathlla e
.lle f
Valuellf k
)llk l
)lll m
{mm 
contextnn 
.nn  
Requestnn  '
.nn' (
Pathnn( ,
=nn- .
$strnn/ <
;nn< =
awaitoo 
nextoo "
(oo" #
)oo# $
;oo$ %
}pp 
}qq 
)qq 
;qq 
appss 
.ss 
UseHstsss 
(ss 
)ss 
;ss 
}tt 
appvv 
.vv 
UseHttpsRedirectionvv #
(vv# $
)vv$ %
;vv% &
appxx 
.xx 
UseCorsxx 
(xx 
xxx 
=>xx 
xxx 
.xx 
AllowAnyOriginxx -
(xx- .
)xx. /
.xx/ 0
AllowAnyMethodxx0 >
(xx> ?
)xx? @
.xx@ A
AllowAnyHeaderxxA O
(xxO P
)xxP Q
)xxQ R
;xxR S
appzz 
.zz 
UseForwardedHeaderszz #
(zz# $
newzz$ '#
ForwardedHeadersOptionszz( ?
{{{ 
ForwardedHeaders||  
=||! "
ForwardedHeaders||# 3
.||3 4
All||4 7
}}} 
)}} 
;}} 
app 
. 
UseStaticFiles 
( 
)  
;  !
app
ÅÅ 
.
ÅÅ 
UseAuthentication
ÅÅ !
(
ÅÅ! "
)
ÅÅ" #
;
ÅÅ# $
app
ÑÑ 
.
ÑÑ 
UseMvc
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
}
ÖÖ 	
}
ÜÜ 
}áá 